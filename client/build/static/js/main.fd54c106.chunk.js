(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{116:function(e,t,a){e.exports=a(266)},155:function(e,t){},158:function(e,t,a){},159:function(e,t,a){},162:function(e,t,a){},210:function(e,t,a){},211:function(e,t,a){},216:function(e,t){},218:function(e,t){},232:function(e,t,a){},240:function(e,t,a){},242:function(e,t,a){},259:function(e,t,a){},260:function(e,t,a){},261:function(e,t,a){},262:function(e,t,a){},263:function(e,t,a){},264:function(e,t,a){},265:function(e,t,a){},266:function(e,t,a){"use strict";a.r(t);var n=a(0),c=a.n(n),r=a(11),o=a.n(r),l=a(8),i=a(6),s=a(64),u=a(32),m=a(7),f=a(105),d=a.n(f),p=a(106),h=a.n(p),g=a(269),E=a(270),b=a(271),v=(a(158),function(e){var t=e.onHandleClick,a=e.className,n=e.name,r=e.disabled,o=e.icon,l="icon-".concat(n);return c.a.createElement("span",{className:"chat__icon ".concat(a," ").concat(r?"disabled":"")},c.a.createElement("label",{className:"chat__label",htmlFor:l},o&&o),c.a.createElement("input",{className:"hidden-input",type:"file",name:l,id:l,accept:"image/*,video/*,audio/*",onChange:function(e){var a=Array.from(e.target.files),n=new FormData;n.append(0,a[0]),t(n.get(0))}}))}),O=(a(159),function(e){var t=e.message,a=void 0===t?"":t,n=e.setMessage,r=e.sendMessage,o=e.sendFile,l=e.uploadFile;return console.log("\u4fe1\u606f",a),c.a.createElement("form",{className:"chat__form"},c.a.createElement("textarea",{className:"chat__message",placeholder:"write some message...",value:a,onChange:function(e){return n(e.target.value)},onKeyPress:function(e){return"Enter"===e.key?n(e.target.value):null}}),c.a.createElement("div",{className:"chat__controls"},c.a.createElement(v,{disabled:a,className:"chat__flex",type:"file",onHandleClick:o,icon:c.a.createElement(g.a,null),name:"files"}),c.a.createElement(v,{disabled:a,className:"chat__flex",type:"file",onHandleClick:l,icon:c.a.createElement(E.a,null),name:"upload"}),c.a.createElement(b.a,{className:"chat__flex",size:"32",onClick:a?function(e){r(e)}:null,color:a?"darkslategray":"#e3e3e3"})))}),j=a(272),y=a(273),_=(a(162),c.a.memo((function(e){var t=e.room,a=e.counts;return c.a.createElement("div",{className:"chat__infoBar"},c.a.createElement("div",{className:"chat__room"},c.a.createElement("h3",null,t)),c.a.createElement("div",{className:"chat__count"},a," ",c.a.createElement(j.a,{color:"#ffffff",size:24})),c.a.createElement("div",{className:"chat__back"},c.a.createElement(l.b,{to:"/"},c.a.createElement(y.a,{color:"white",size:24}))))}))),S=a(45),C=a(108),N=a.n(C),w=a(282),k=a(274),U=a(275),x=a(109),L=a.n(x),I=(a(210),function(e){var t=e.message,a=t.user,n=t.text,r=t.upload,o=t.type,l=t.address,i=t.percent,s=e.name,u=e.avatarSrc;console.log("\u6700\u5f8c",a,n);var m=!1,f=s.trim().toLowerCase();f===a&&(m=!0);var d=m?"user":"friend",p="user"===d?f:a;return c.a.createElement("div",{className:"chat-message chat-message--".concat(d)},"friend"===d&&c.a.createElement("h4",null,u?c.a.createElement(k.a,{src:u,roundedCircle:!0}):c.a.createElement(U.a,{size:24}),c.a.createElement("span",null,p)),c.a.createElement("div",{className:"chat-message__body"},function(e){if(e>0&&e<100)return c.a.createElement(c.a.Fragment,null,"loading...",c.a.createElement(w.a,{now:e,animated:!0}))}(i),function(e){var t=e.address,a=e.type,n=e.upload;if(t)return c.a.createElement("div",{dangerouslySetInnerHTML:{__html:t}});if(a&&n)switch(a){case"video/mp4":return c.a.createElement("video",{width:"100%",controls:!0},c.a.createElement("source",{src:"data:image/png;base64, ".concat(n),type:"video/mp4"}),c.a.createElement("source",{src:"data:image/png;base64, ".concat(n),type:"video/ogg"}),"Your browser does not support the video tag.");case"image/*":default:return c.a.createElement("img",{className:"img-thumbnail img-fluid",src:"data:image/png;base64, ".concat(n)})}}({address:l,percent:i,type:o,upload:r}),n&&c.a.createElement("p",{className:"chat-message__body--text"},L.a.emojify(n))))}),F=(a(211),c.a.memo((function(e){var t=e.messages,a=e.name,n=Object(S.a)(e,["messages","name"]);return c.a.createElement(N.a,{className:"chat__messages"},t.map((function(e){return c.a.createElement(I,Object.assign({key:"name-".concat(e.id),message:e,name:a},n))})))}))),D=a(43),P=a(44),B=a(20),R=a.n(B);function T(e,t,a){for(var n=e.split(","),c=n[0].match(/:(.*?);/)[1],r=atob(n[1]),o=r.length,l=new Uint8Array(o);o--;)l[o]=r.charCodeAt(o);return new File([l],t.name,{type:c})}var z,H=function(){function e(t,a,n){Object(D.a)(this,e),console.log("\u6a94\u6848",t),this.socket=a,this.file=t,this.name=t.name}return Object(P.a)(e,[{key:"send",value:function(){var e=R.a.createStream();R.a.createBlobReadStream(this.file).pipe(e),R()(this.socket).emit("sendFile",e,{name:this.file.name,type:this.file.type,size:this.file.size}),console.log("this.file",this.file)}},{key:"upload",value:function(){var e=R.a.createStream();R()(this.socket).emit("uploadFile",e,{name:this.file.name,type:this.file.type,size:this.file.size}),R.a.createBlobReadStream(this.file).pipe(e)}}],[{key:"process",value:function(t,a){var n=this,c={name:t.name,quality:.6,type:t.type};return J(t,c).then((function(e){var t=e.readerDataUrl,a=e.config;e.callback;switch(n.base64=t,console.log("\u8f49\u63db\u6210convertToDataUrl"),a.type){case"image/jpeg":case"video/mp4":return new Promise((function(e){e(T(t,a))}));default:alert("the type is not supprted")}})).then((function(t){return n.data=t,new e(n.data,a)}))}}]),e}(),J=function(e,t,a){return new Promise((function(n){var c=new FileReader;c.readAsDataURL(e),c.onload=function(){var e=this.result;console.log("\u52a0\u8f09\u958b\u59cb"),n({readerDataUrl:e,config:t,callback:a})},c.onloadend=function(){console.log("\u52a0\u8f09\u5df2\u7d93\u7d50\u675f")}}))},A=H,G=function(){var e=Object(i.g)().search,t=Object(n.useState)(""),a=Object(m.a)(t,2),r=a[0],o=a[1],l=Object(n.useState)(""),f=Object(m.a)(l,2),p=f[0],g=f[1],E=Object(n.useState)(null),b=Object(m.a)(E,2),v=b[0],j=b[1],y=Object(n.useState)([]),S=Object(m.a)(y,2),C=S[0],N=S[1],w=Object(n.useState)(0),k=Object(m.a)(w,2),U=k[0],x=k[1],L="localhost:5000";L="https://freshtalk.herokuapp.com",Object(n.useEffect)((function(){var t=d.a.parse(e),a=t.name,n=t.room;return z=h()(L,{path:"/socket.io",transports:["websocket"],secure:!0}),o(a),g(n),z.emit("join",{name:a,room:n},(function(e){e&&alert(e)})),function(){z.emit("disconnect"),z.off()}}),[L,e]),Object(n.useEffect)((function(){var e=function(e,t){return e.id===t};z.on("message",(function(e){return N((function(t){return[].concat(Object(u.a)(t),[e])}))})),z.on("percent",(function(t,a){var n=a.id,c=a.user,r=a.type;N((function(a){var o=a.findIndex((function(t){return e(t,n)}));return o<0?function(e){var t=e.messages,a=e.id,n=e.upload,c=void 0===n?"":n,r=e.user,o=e.type,l=e.percent;return[].concat(Object(u.a)(t),[{id:a,upload:c,user:r,type:o,percent:l}])}({messages:a,id:n,percent:t,user:c,type:r}):(a[o].percent=t,Object(u.a)(a))}))})),z.on("file",(function(t){var a=t.user,n=t.upload,c=t.type,r=t.id;n&&N((function(t){return function(e,t,a){return t[e]=Object(s.a)(Object(s.a)({},t[e]),a),Object(u.a)(t)}(t.findIndex((function(t){return e(t,r)})),t,{id:r,user:a,upload:n,type:c})}))}))}),[]),Object(n.useEffect)((function(){z.on("roomData",(function(e){var t=e.users;x(t.length)}))}),[U]);return c.a.createElement(c.a.Fragment,null,c.a.createElement(_,{room:p,counts:U}),c.a.createElement(F,{messages:C,name:r}),c.a.createElement(O,{message:v,setMessage:j,sendMessage:function(e){e.preventDefault(),v&&z.emit("sendMessage",v,(function(){return j("")}))},sendFile:function(e){A.process(e,z).then((function(e){e.send()}))},uploadFile:function(e){A.process(e,z).then((function(e){return e.upload()}))}}))},M=a(279),K=a(280),W=(a(232),function(e){var t=e.title,a=e.content,n=e.control,r=e.hasNotification,o=e.notificationContent,l=c.a.createElement(K.a,{node:document&&document.getElementById("portal")},c.a.createElement(M.a,{delay:3e3,autohide:!0},c.a.createElement(M.a.Header,null,c.a.createElement("strong",{className:"mr-auto"},"FAILURE")),c.a.createElement(M.a.Body,null,o)));return c.a.createElement("div",{className:"chat__box"},c.a.createElement("h1",null,t),a,c.a.createElement("div",null,n),r&&l)});W.defaultProps={setHasNotification:function(){},hasNotification:!1};var q=W,V=a(278),Y=a(281),Q=(a(240),function(){var e=Object(n.useState)(""),t=Object(m.a)(e,2),a=t[0],r=t[1],o=Object(n.useState)(""),i=Object(m.a)(o,2),s=i[0],u=i[1],f=Object(n.useState)(),d=Object(m.a)(f,2),p=d[0],h=d[1];return c.a.createElement(q,{title:"Join",content:c.a.createElement(V.a,null,c.a.createElement("input",{type:"file",onChange:function(e){h(URL.createObjectURL(e.target.files[0]))}}),c.a.createElement("img",{width:"50px",src:p}),c.a.createElement(V.a.Group,{controlId:"formBasicPassword"},c.a.createElement(V.a.Label,null,"Username"),c.a.createElement(V.a.Control,{type:"text",placeholder:"Username",onChange:function(e){return r(e.target.value)}}),c.a.createElement(V.a.Label,null,"Room"),c.a.createElement(V.a.Control,{type:"text",placeholder:"Room",onChange:function(e){return u(e.target.value)}}))),control:c.a.createElement(l.b,{onClick:function(e){return a&&s?null:e.preventDefault()},to:"/chat?name=".concat(a,"&room=").concat(s)},c.a.createElement(Y.a,{block:!0,type:"submit"},"Join In"))})}),X=(a(242),a(31)),Z=a.n(X),$="https://freshtalk.herokuapp.com/api/auth/",ee=new(function(){function e(){Object(D.a)(this,e)}return Object(P.a)(e,[{key:"login",value:function(e,t){return Z.a.post($+"signin",{username:e,password:t}).then((function(e){return e.data.accessToken&&localStorage.setItem("user",JSON.stringify(e.data)),e.data}))}},{key:"logout",value:function(){localStorage.removeItem("user")}},{key:"signup",value:function(e,t,a){return Z.a.post($+"signup",{username:e,email:t,password:a})}},{key:"getCurrentUser",value:function(){return JSON.parse(localStorage.getItem("user"))}}]),e}()),te=(a(259),function(e){var t=Object(n.useState)(!1),a=Object(m.a)(t,2),r=a[0],o=a[1],l=Object(n.useState)(""),s=Object(m.a)(l,2),u=s[0],f=s[1],d=Object(n.useState)(""),p=Object(m.a)(d,2),h=p[0],g=p[1],E=Object(n.useState)(!1),b=Object(m.a)(E,2),v=b[0],O=b[1];if(!0===r)return c.a.createElement(i.a,{to:"join"});return c.a.createElement(c.a.Fragment,null,c.a.createElement(q,{title:"Login",content:c.a.createElement(V.a,null,c.a.createElement(V.a.Group,{controlId:"formBasicName"},c.a.createElement(V.a.Label,null,"Username"),c.a.createElement(V.a.Control,{type:"text",placeholder:"Username",onChange:function(e){f(e.target.value)}})),c.a.createElement(V.a.Group,{controlId:"formBasicPassword"},c.a.createElement(V.a.Label,null,"Password"),c.a.createElement(V.a.Control,{type:"password",placeholder:"Password",onChange:function(e){g(e.target.value)}}))),control:c.a.createElement(Y.a,{onClick:function(e){e.preventDefault(),ee.login(u,h).then((function(e){console.log("\u8cc7\u6599",e),o(!0)})).catch((function(e){console.log("catch",e),O(!0)}))},variant:"primary",type:"submit"},"Submit"),hasNotification:v,notificationContent:"Oops, something went wrong!"}))}),ae=(a(260),function(e){var t=Object(n.useState)(""),a=Object(m.a)(t,2),r=a[0],o=a[1],l=Object(n.useState)(""),s=Object(m.a)(l,2),u=s[0],f=s[1],d=Object(n.useState)(""),p=Object(m.a)(d,2),h=p[0],g=p[1],E=Object(n.useState)(!1),b=Object(m.a)(E,2),v=b[0],O=b[1],j=Object(n.useState)(!1),y=Object(m.a)(j,2),_=y[0],S=y[1];return v?c.a.createElement(i.a,{to:"login"}):(console.log("process",Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0})),c.a.createElement(q,{title:"Sign Up",content:c.a.createElement(V.a,null,c.a.createElement(V.a.Group,{controlId:"formBasicName"},c.a.createElement(V.a.Label,null,"Username"),c.a.createElement(V.a.Control,{type:"text",placeholder:"Normal text",onChange:function(e){o(e.target.value)},value:r})),c.a.createElement(V.a.Group,{controlId:"formBasicEmail"},c.a.createElement(V.a.Label,null,"Email address"),c.a.createElement(V.a.Control,{type:"email",placeholder:"Enter email",onChange:function(e){f(e.target.value)},value:u})),c.a.createElement(V.a.Group,{controlId:"formBasicPassword"},c.a.createElement(V.a.Label,null,"Password"),c.a.createElement(V.a.Control,{type:"password",placeholder:"Password",onChange:function(e){g(e.target.value)},value:h}))),control:c.a.createElement(Y.a,{onClick:function(e){e.preventDefault(),Z.a.post("/api/auth/signup",{username:r,email:u,password:h,roles:["user"]}).then((function(e){O(!0)})).catch((function(e){console.log("catch",e),S(!0)}))},variant:"primary",type:"submit"},"Sign Up"),setHasNotification:S,hasNotification:_,notificationContent:"Oops, something went wrong!"}))}),ne=(a(261),function(){return c.a.createElement("div",{className:"chat-home"},c.a.createElement("h1",null,"Fresh Talk"),c.a.createElement("div",{className:"chat-home__controls"},c.a.createElement(l.b,{to:"/signup"},"Sign up"),ee.getCurrentUser()?c.a.createElement(l.b,{to:"/join"},"Join"):c.a.createElement(l.b,{to:"/login"},"Login")))}),ce=(a(262),function(e){var t=e.children;return c.a.createElement("section",{className:"chat__head"},t)}),re=function(e){var t=e.component,a=Object(S.a)(e,["component"]);return c.a.createElement(i.b,Object.assign({},a,{render:function(e){return ee.getCurrentUser()?c.a.createElement(t,e):c.a.createElement(i.a,{to:{pathname:"/login",state:{from:e.location}}})}}))},oe=a(276),le=(a(263),Object(i.h)((function(e){var t=e.history;return ee.getCurrentUser()&&c.a.createElement(oe.a,{size:"30",color:"#fff",onClick:function(){ee.logout(),t.push("/")}},"Sign out")}))),ie=(a(277),a(264),a(265),function(){return c.a.createElement(l.a,null,c.a.createElement(ce,null,c.a.createElement(le,null)),c.a.createElement(i.d,null,c.a.createElement(i.b,{path:"/",exact:!0,component:ne}),c.a.createElement(i.b,{path:"/Signup",component:ae}),c.a.createElement(i.b,{path:"/login",component:te}),c.a.createElement(re,{path:"/join",component:Q}),c.a.createElement(re,{path:"/chat",component:G}),c.a.createElement(i.a,{from:"*",to:"/"})),c.a.createElement("div",{id:"portal"}))});o.a.render(c.a.createElement(ie,null),document.querySelector("#root"))}},[[116,1,2]]]);
//# sourceMappingURL=main.fd54c106.chunk.js.map