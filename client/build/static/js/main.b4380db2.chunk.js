(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{114:function(e,t,a){e.exports=a(257)},153:function(e,t){},156:function(e,t,a){},157:function(e,t,a){},160:function(e,t,a){},208:function(e,t,a){},209:function(e,t,a){},214:function(e,t){},216:function(e,t){},230:function(e,t,a){},231:function(e,t,a){},233:function(e,t,a){},250:function(e,t,a){},251:function(e,t,a){},252:function(e,t,a){},253:function(e,t,a){},254:function(e,t,a){},255:function(e,t,a){},256:function(e,t,a){},257:function(e,t,a){"use strict";a.r(t);var n,c=a(0),o=a.n(c),r=a(25),i=a.n(r),l=a(8),s=a(6),u=a(58),m=a(7),f=a(100),d=a.n(f),h=a(101),p=a.n(h),E=a(259),g=a(260),b=a(261),v=(a(156),function(e){var t=e.onHandleClick,a=e.className,n=e.name,c=e.disabled,r=e.icon,i="icon-".concat(n);return o.a.createElement("span",{className:"chat__icon ".concat(a," ").concat(c?"disabled":"")},o.a.createElement("label",{className:"chat__label",htmlFor:i},r&&r),o.a.createElement("input",{className:"hidden-input",type:"file",name:i,id:i,accept:"image/*,video/*,audio/*",onChange:function(e){var a=Array.from(e.target.files),n=new FormData;n.append(0,a[0]),t(n.get(0))}}))}),y=(a(157),function(e){var t=e.message,a=e.setMessage,n=e.sendMessage,c=e.sendFile,r=e.uploadFile;return o.a.createElement("form",{className:"chat__form"},o.a.createElement("textarea",{className:"chat__message",placeholder:"write some message...",value:t,onChange:function(e){return a(e.target.value)},onKeyPress:function(e){return"Enter"===e.key?a(e.target.value):null}}),o.a.createElement("div",{className:"chat__controls"},o.a.createElement(v,{disabled:t,className:"chat__flex",type:"file",onHandleClick:c,icon:o.a.createElement(E.a,null),name:"files"}),o.a.createElement(v,{disabled:t,className:"chat__flex",type:"file",onHandleClick:r,icon:o.a.createElement(g.a,null),name:"upload"}),o.a.createElement(b.a,{className:"chat__flex",size:"32",onClick:t?function(e){console.log("dddd",e.target.value),n(e)}:null,color:t?"darkslategray":"#e3e3e3"})))}),j=a(262),O=a(263),w=(a(160),o.a.memo((function(e){var t=e.room,a=e.counts;return o.a.createElement("div",{className:"chat__infoBar"},o.a.createElement("div",{className:"chat__room"},o.a.createElement("h3",null,t)),o.a.createElement("div",{className:"chat__count"},a," ",o.a.createElement(j.a,{color:"#ffffff",size:24})),o.a.createElement("div",{className:"chat__back"},o.a.createElement(l.b,{to:"/"},o.a.createElement(O.a,{color:"white",size:24}))))}))),_=a(103),N=a.n(_),C=a(264),S=a(265),k=a(104),x=a.n(k),D=(a(208),function(e){var t=e.message,a=t.user,n=t.text,c=t.upload,r=t.type,i=t.address,l=e.name,s=e.avatarSrc,u=!1,m=l.trim().toLowerCase();m===a&&(u=!0);var f=u?"user":"friend",d="user"===f?m:a;return o.a.createElement("div",{className:"chat-message chat-message--".concat(f)},"friend"===f&&o.a.createElement("h4",null,s?o.a.createElement(C.a,{src:s,roundedCircle:!0}):o.a.createElement(S.a,{size:24}),o.a.createElement("span",null,d)),o.a.createElement("div",{className:"chat-message__body"},function(e,t){if(e)return o.a.createElement("div",{dangerouslySetInnerHTML:{__html:e}});if(t)switch(t){case"video/mp4":case"video/quicktime":return o.a.createElement("video",{controls:!0},o.a.createElement("source",{src:"data:image/png;base64, ".concat(c),type:"video/mp4"}),o.a.createElement("source",{src:"data:image/png;base64, ".concat(c),type:"video/ogg"}),"Your browser does not support the video tag.");case"image/*":default:return o.a.createElement("img",{className:"img-thumbnail img-fluid",src:"data:image/png;base64, ".concat(c)})}return o.a.createElement("p",{className:"chat-message__body--text"},x.a.emojify(n))}(i,r)))}),F=(a(209),o.a.memo((function(e){var t=e.messages,a=e.name;return o.a.createElement(N.a,{className:"chat__messages"},t.map((function(e,t){return o.a.createElement(D,{key:"name-".concat(t),message:e,name:a})})))}))),A=a(105),M=a(106),L=a(14),P=a.n(L),z=function(){function e(t,a,n){Object(A.a)(this,e),this.socket=a,this.file=t,this.name=t.name}return Object(M.a)(e,[{key:"send",value:function(){var e=P.a.createStream();P()(this.socket).emit("sendFile",e,{name:this.file.name,type:this.file.type,size:this.file.size});P.a.createBlobReadStream(this.file).pipe(e)}},{key:"upload",value:function(){var e=P.a.createStream();P()(this.socket).emit("uploadFile",e,{name:this.file.name,type:this.file.type,size:this.file.size});P.a.createBlobReadStream(this.file).pipe(e)}}],[{key:"process",value:function(t,a){var n=this,c={name:t.name,quality:.6};return B(t,c).then((function(e){var t=e.readerData,a=e.config,c=e.callback;return n.base64=t,R(t,a,c)})).then((function(e){var t=e.base64,a=e.config,c=e.callback;return n.minifiedBase64=t,H(t,a,c)})).then((function(t){return n.minifiedFile=t,new e(n.minifiedFile,a)}))}}]),e}(),B=function(e,t,a){return console.log("\u958b\u59cb",e),new Promise((function(n){var c=new FileReader;c.readAsDataURL(e),c.onload=function(){var e=this.result;n({readerData:e,config:t,callback:a})},c.onloadend=function(){console.log("\u52a0\u8f09\u5df2\u7d93\u7d50\u675f")}}))},R=function(e,t,a){return new Promise((function(n){var c=new Image;c.src=e,c.onload=function(){var e=400/(c.width/c.height),o=.7,r=document.createElement("canvas"),i=r.getContext("2d"),l=document.createAttribute("width");l.nodeValue=400;var s=document.createAttribute("height");s.nodeValue=e,r.setAttributeNode(l),r.setAttributeNode(s),i.drawImage(c,0,0,400,e),t.quality&&t.quality<=1&&t.quality>0&&(o=t.quality);var u=r.toDataURL("image/jpeg","image/webp",o);n({base64:u,config:t,callback:a})}}))},H=function(e,t){for(var a=e.split(","),n=a[0].match(/:(.*?);/)[1],c=atob(a[1]),o=c.length,r=new Uint8Array(o);o--;)r[o]=c.charCodeAt(o);return new File([r],t.name,{type:n})},I=z,U=function(){var e=Object(s.g)().search,t=Object(c.useState)(""),a=Object(m.a)(t,2),r=a[0],i=a[1],l=Object(c.useState)(""),f=Object(m.a)(l,2),h=f[0],E=f[1],g=Object(c.useState)(""),b=Object(m.a)(g,2),v=b[0],j=b[1],O=Object(c.useState)([]),_=Object(m.a)(O,2),N=_[0],C=_[1],S=Object(c.useState)(0),k=Object(m.a)(S,2),x=k[0],D=k[1],A="https://freshtalk.herokuapp.com";Object(c.useEffect)((function(){var t=d.a.parse(e),a=t.name,c=t.room;return n=p()(A),i(a),E(c),n.emit("join",{name:a,room:c},(function(e){e&&alert(e)})),function(){n.emit("disconnect"),n.off()}}),[A,e]),Object(c.useEffect)((function(){n.on("message",(function(e){C((function(t){return[].concat(Object(u.a)(t),[e])}))})),n.on("file",(function(e){var t=e.user,a=e.upload,n=e.type;a&&C((function(e){return[].concat(Object(u.a)(e),[{user:t,upload:a,type:n}])}))}))}),[]),Object(c.useEffect)((function(){n.on("roomData",(function(e){var t=e.users;D(t.length)}))}),[x]);return o.a.createElement(o.a.Fragment,null,o.a.createElement(w,{room:h,counts:x}),o.a.createElement(F,{messages:N,name:r}),o.a.createElement(y,{message:v,setMessage:j,sendMessage:function(e){e.preventDefault(),v&&n.emit("sendMessage",v,(function(){return j("")}))},sendFile:function(e){I.process(e,n).then((function(e){e.send()}))},uploadFile:function(e){I.process(e,n).then((function(e){e.upload()}))}}))},q=a(269),Q=(a(230),a(21)),W=function(){var e=Object(Q.useMediaQuery)({minDeviceWidth:1224}),t=Object(Q.useMediaQuery)({minDeviceWidth:1824}),a=Object(Q.useMediaQuery)({maxWidth:1224}),n=Object(Q.useMediaQuery)({maxDeviceWidth:1224}),c=Object(Q.useMediaQuery)({orientation:"portrait"}),o=Object(Q.useMediaQuery)({minResolution:"2dppx"});return console.log("fff",e,t,a,n,c,o),{isDesktopOrLaptop:e,isBigScreen:t,isTabletOrMobile:a,isTabletOrMobileDevice:n,isPortrait:c,isRetina:o}},G=function(e){var t=e.title,a=e.content,n=e.control,c=e.setHasNotification,r=e.hasNotification,i=e.notificationContent;W();return o.a.createElement("div",{className:"chat__box"},o.a.createElement("h1",null,t),a,o.a.createElement("div",null,n),o.a.createElement(q.a,{onClose:function(){return c(!1)},show:r,delay:3e3,autohide:!0},o.a.createElement(q.a.Header,null,o.a.createElement("img",{src:"holder.js/20x20?text=%20",className:"rounded mr-2",alt:""}),o.a.createElement("strong",{className:"mr-auto"},"FAILURE"),o.a.createElement("small",null,"11 mins ago")),o.a.createElement(q.a.Body,null,i)))};G.defaultProps={setHasNotification:function(){},hasNotification:!1};var J=G,T=a(268),V=a(270),K=(a(231),function(){var e=Object(c.useState)(""),t=Object(m.a)(e,2),a=t[0],n=t[1],r=Object(c.useState)(""),i=Object(m.a)(r,2),s=i[0],u=i[1];return o.a.createElement(J,{title:"Join",content:o.a.createElement(T.a,null,o.a.createElement(T.a.Group,{controlId:"formBasicPassword"},o.a.createElement(T.a.Label,null,"Username"),o.a.createElement(T.a.Control,{type:"text",placeholder:"Username",onChange:function(e){return n(e.target.value)}}),o.a.createElement(T.a.Label,null,"Room"),o.a.createElement(T.a.Control,{type:"text",placeholder:"Room",onChange:function(e){return u(e.target.value)}}))),control:o.a.createElement(l.b,{onClick:function(e){return a&&s?null:e.preventDefault()},to:"/chat?name=".concat(a,"&room=").concat(s)},o.a.createElement(V.a,{block:!0,type:"submit"},"Join In"))})}),Y=(a(233),{isAuthenticated:!1,authenticate:function(e){this.isAuthenticated=!0,e()},signout:function(e){this.isAuthenticated=!1,e()}}),X=a(40),Z=a.n(X),$=(a(250),function(e){var t=Object(c.useState)(!1),a=Object(m.a)(t,2),n=a[0],r=a[1],i=Object(c.useState)(""),l=Object(m.a)(i,2),u=l[0],f=l[1],d=Object(c.useState)(""),h=Object(m.a)(d,2),p=h[0],E=h[1],g=Object(c.useState)(!1),b=Object(m.a)(g,2),v=b[0],y=b[1];(e.location.state||{from:{pathname:"/"}}).from;if(!0===n)return o.a.createElement(s.a,{to:"join"});return o.a.createElement(J,{title:"Login",content:o.a.createElement(T.a,null,o.a.createElement(T.a.Control,{type:"text",placeholder:"Username",onChange:function(e){f(e.target.value)}}),o.a.createElement(T.a.Group,{controlId:"formBasicPassword"},o.a.createElement(T.a.Label,null,"Password"),o.a.createElement(T.a.Control,{type:"password",placeholder:"Password",onChange:function(e){E(e.target.value)}}))),control:o.a.createElement(V.a,{onClick:function(e){e.preventDefault(),Z.a.post("/api/auth/signin",{username:u,password:p}).then((function(e){Y.authenticate((function(){r(!0)}))})).catch((function(e){console.log("catch",e),y(!0)}))},variant:"primary",type:"submit"},"Submit"),setHasNotification:y,hasNotification:v,notificationContent:"Oops, something went wrong!"})}),ee=(a(251),function(e){var t=Object(c.useState)(""),a=Object(m.a)(t,2),n=a[0],r=a[1],i=Object(c.useState)(""),l=Object(m.a)(i,2),u=l[0],f=l[1],d=Object(c.useState)(""),h=Object(m.a)(d,2),p=h[0],E=h[1],g=Object(c.useState)(!1),b=Object(m.a)(g,2),v=b[0],y=b[1],j=Object(c.useState)(!1),O=Object(m.a)(j,2),w=O[0],_=O[1];return v?o.a.createElement(s.a,{to:"login"}):o.a.createElement(J,{title:"Sign Up",content:o.a.createElement(T.a,null,o.a.createElement(T.a.Control,{type:"text",placeholder:"Normal text",onChange:function(e){r(e.target.value)},value:n}),o.a.createElement(T.a.Group,{controlId:"formBasicEmail"},o.a.createElement(T.a.Label,null,"Email address"),o.a.createElement(T.a.Control,{type:"email",placeholder:"Enter email",onChange:function(e){f(e.target.value)},value:u}),o.a.createElement(T.a.Text,{className:"text-muted"},"We'll never share your email with anyone else.")),o.a.createElement(T.a.Group,{controlId:"formBasicPassword"},o.a.createElement(T.a.Label,null,"Password"),o.a.createElement(T.a.Control,{type:"password",placeholder:"Password",onChange:function(e){E(e.target.value)},value:p}))),control:o.a.createElement(V.a,{onClick:function(e){e.preventDefault(),Z.a.post("/api/auth/signup",{username:n,email:u,password:p,roles:["user"]}).then((function(e){y(!0)})).catch((function(e){console.log("catch",e),_(!0)}))},variant:"primary",type:"submit"},"Sign Up"),setHasNotification:_,hasNotification:w,notificationContent:"Oops, something went wrong!"})}),te=(a(252),function(){return o.a.createElement(o.a.Fragment,null,o.a.createElement("h1",null,"EazyChat"),o.a.createElement(l.b,{to:"/signup"},"Sign up"),o.a.createElement(l.b,{to:"/login"},"Login"))}),ae=(a(253),function(e){var t=e.children;return o.a.createElement("section",{className:"chat__head"},t)}),ne=a(113),ce=function(e){var t=e.component,a=Object(ne.a)(e,["component"]);return o.a.createElement(s.b,Object.assign({},a,{render:function(e){return!0===Y.isAuthenticated?o.a.createElement(t,e):o.a.createElement(s.a,{to:{pathname:"/login",state:{from:e.location}}})}}))},oe=a(266),re=(a(254),Object(s.h)((function(e){var t=e.history;return Y.isAuthenticated&&o.a.createElement(oe.a,{size:"30",color:"#fff",onClick:function(){Y.signout((function(){return t.push("/")}))}},"Sign out")}))),ie=(a(267),a(255),a(256),function(){return o.a.createElement(l.a,null,o.a.createElement(ae,null,o.a.createElement(re,null)),o.a.createElement(s.d,null,o.a.createElement(s.b,{path:"/",exact:!0,component:te}),o.a.createElement(s.b,{path:"/Signup",component:ee}),o.a.createElement(s.b,{path:"/login",component:$}),o.a.createElement(ce,{path:"/join",component:K}),o.a.createElement(ce,{path:"/chat",component:U}),o.a.createElement(s.a,{from:"*",to:"/"})))});i.a.render(o.a.createElement(ie,null),document.querySelector("#root"))}},[[114,1,2]]]);
//# sourceMappingURL=main.b4380db2.chunk.js.map