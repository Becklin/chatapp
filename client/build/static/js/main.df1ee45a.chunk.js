(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{106:function(e,t,a){e.exports=a(253)},147:function(e,t){},150:function(e,t,a){},151:function(e,t,a){},154:function(e,t,a){},203:function(e,t,a){},204:function(e,t,a){},210:function(e,t){},212:function(e,t){},226:function(e,t,a){},227:function(e,t,a){},229:function(e,t,a){},246:function(e,t,a){},247:function(e,t,a){},248:function(e,t,a){},249:function(e,t,a){},250:function(e,t,a){},251:function(e,t,a){},252:function(e,t,a){},253:function(e,t,a){"use strict";a.r(t);var n=a(0),c=a.n(n),r=a(98),o=a.n(r),l=a(8),s=a(7),i=a(6),u=Object(n.createContext)(),m=function(e){var t=Object(n.useState)({}),a=Object(i.a)(t,2),r=a[0],o=a[1];return c.a.createElement(u.Provider,{value:[r,o]},e.children)},f=a(59),d=a(29),p=a(99),h=a.n(p),g=a(100),E=a.n(g),b=a(254),v=a(255),O=a(256),j=(a(150),function(e){var t=e.onHandleClick,a=e.className,n=e.name,r=e.disabled,o=e.icon,l="icon-".concat(n);return c.a.createElement("span",{className:"chat__icon ".concat(a," ").concat(r?"disabled":"")},c.a.createElement("label",{className:"chat__label",htmlFor:l},o&&o),c.a.createElement("input",{className:"hidden-input",type:"file",name:l,id:l,accept:"image/*,video/*,audio/*",onChange:function(e){var a=Array.from(e.target.files),n=new FormData;n.append(0,a[0]),t(n.get(0))}}))}),y=(a(151),function(e){var t=e.message,a=void 0===t?"":t,n=e.setMessage,r=e.sendMessage,o=e.sendFile,l=e.uploadFile;return console.log("\u4fe1\u606f",a),c.a.createElement("form",{className:"chat__form"},c.a.createElement("textarea",{className:"chat__message",placeholder:"write some message...",value:a,onChange:function(e){return n(e.target.value)},onKeyPress:function(e){return"Enter"===e.key?n(e.target.value):null}}),c.a.createElement("div",{className:"chat__controls"},c.a.createElement(j,{disabled:a,className:"chat__flex",type:"file",onHandleClick:o,icon:c.a.createElement(b.a,null),name:"files"}),c.a.createElement(j,{disabled:a,className:"chat__flex",type:"file",onHandleClick:l,icon:c.a.createElement(v.a,null),name:"upload"}),c.a.createElement(O.a,{className:"chat__flex",size:"32",onClick:a?function(e){r(e)}:null,color:a?"darkslategray":"#e3e3e3"})))}),_=a(257),S=a(258),C=(a(154),c.a.memo((function(e){var t=e.room,a=e.counts;return c.a.createElement("div",{className:"chat__infoBar"},c.a.createElement("div",{className:"chat__room"},c.a.createElement("h3",null,t)),c.a.createElement("div",{className:"chat__count"},a," ",c.a.createElement(_.a,{color:"#ffffff",size:24})),c.a.createElement("div",{className:"chat__back"},c.a.createElement(l.b,{to:"/"},c.a.createElement(S.a,{color:"white",size:24}))))}))),k=a(41),N=a(102),w=a.n(N),x=a(265),U=a(259),L=a(260),P=a(103),D=a.n(P),F=a(104),I=a.n(F),T=(a(203),function(e){e.message;var t=e.message,a=t.user,n=t.content,r=t.upload,o=t.type,l=t.address,s=t.percent,i=t.date,u=e.name,m=e.avatarSrc,f=!1,d=u.trim().toLowerCase();d===a&&(f=!0);var p=f?"user":"friend",h="user"===p?d:a;return c.a.createElement("div",{className:"chat-message chat-message--".concat(p)},"friend"===p&&c.a.createElement("h4",null,m?c.a.createElement(U.a,{src:m,roundedCircle:!0}):c.a.createElement(L.a,{size:24}),c.a.createElement("span",null,h)),c.a.createElement("div",{className:"chat-message__body"},function(e){if(e>0&&e<100)return c.a.createElement(c.a.Fragment,null,"loading...",c.a.createElement(x.a,{now:e,animated:!0}))}(s),c.a.createElement("span",{className:"chat-message__date"},I()(i).format("LTS")),function(e){var t=e.address,a=e.type,n=e.upload;if(t)return c.a.createElement("div",{dangerouslySetInnerHTML:{__html:t}});if(a&&n)switch(a){case"video/mp4":return c.a.createElement("video",{width:"100%",controls:!0},c.a.createElement("source",{src:"data:image/png;base64, ".concat(n),type:"video/mp4"}),c.a.createElement("source",{src:"data:image/png;base64, ".concat(n),type:"video/ogg"}),"Your browser does not support the video tag.");case"image/*":default:return c.a.createElement("img",{className:"img-thumbnail img-fluid",src:"data:image/png;base64, ".concat(n)})}}({address:l,percent:s,type:o,upload:r}),n&&c.a.createElement("p",{className:"chat-message__body--text"},D.a.emojify(n))))}),z=(a(204),c.a.memo((function(e){var t=e.messages,a=e.name,n=Object(k.a)(e,["messages","name"]);return c.a.createElement(w.a,{className:"chat__messages"},t.map((function(e){return c.a.createElement(T,Object.assign({key:"name-".concat(e.id),message:e,name:a},n))})))}))),B=a(57),R=a.n(B),H=a(105),J=a(39),G=a(40),M=a(19),A=a.n(M);function K(e,t,a){for(var n=e.split(","),c=n[0].match(/:(.*?);/)[1],r=atob(n[1]),o=r.length,l=new Uint8Array(o);o--;)l[o]=r.charCodeAt(o);return new File([l],t.name,{type:c})}var W,q=function(){function e(t,a,n){Object(J.a)(this,e),console.log("\u6a94\u6848",t),this.socket=a,this.file=t,this.name=t.name}return Object(G.a)(e,[{key:"send",value:function(){console.log("\u9001\u51fa",this,this.file.size);var e=A.a.createStream();A.a.createBlobReadStream(this.file).pipe(e),A()(this.socket).emit("sendFile",e,{name:this.file.name,type:this.file.type,size:this.file.size}),console.log("this.file",this.file)}},{key:"upload",value:function(){var e=A.a.createStream();A()(this.socket).emit("uploadFile",e,{name:this.file.name,type:this.file.type,size:this.file.size}),A.a.createBlobReadStream(this.file).pipe(e)}}],[{key:"process",value:function(t,a){var n=this,c={name:t.name,quality:.6,type:t.type};return V(t,c).then((function(e){var t=e.readerDataUrl,a=e.config;e.callback;switch(n.base64=t,console.log("\u8f49\u63db\u6210convertToDataUrl"),a.type){case"image/jpeg":case"video/mp4":return new Promise((function(e){e(K(t,a))}));default:alert("the type is not supprted")}})).then((function(t){return n.data=t,new e(n.data,a)}))}}]),e}(),V=function(){var e=Object(H.a)(R.a.mark((function e(t,a,n){var c;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=function(e,t,a){return new Promise((function(n,c){var r=new FileReader;r.readAsDataURL(e),r.onload=function(){var e=this.result;console.log("\u52a0\u8f09\u958b\u59cb"),n({readerDataUrl:e,config:t,callback:a})},r.onerror=function(){return c("\u52a0\u8f7d\u5931\u8d25")},r.onloadend=function(){console.log("\u52a0\u8f09\u5df2\u7d93\u7d50\u675f")}}))},e.next=3,c(t,a,n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),Y=q,Q=function(){var e=Object(s.g)().search,t=Object(n.useState)(""),a=Object(i.a)(t,2),r=a[0],o=a[1],l=Object(n.useState)(""),u=Object(i.a)(l,2),m=u[0],p=u[1],g=Object(n.useState)(null),b=Object(i.a)(g,2),v=b[0],O=b[1],j=Object(n.useState)([]),_=Object(i.a)(j,2),S=_[0],k=_[1],N=Object(n.useState)(0),w=Object(i.a)(N,2),x=w[0],U=w[1],L="localhost:5000";L="https://dailytalk.herokuapp.com",console.log(L),Object(n.useEffect)((function(){var t=h.a.parse(e),a=t.name,n=t.room;return W=E()(L,{path:"/socket.io",transports:["websocket"],secure:!0}),o(a),p(n),W.emit("join",{name:a,room:n},(function(e){e&&alert(e)})),function(){W.emit("disconnect"),W.off()}}),[L,e]),Object(n.useEffect)((function(){var e=function(e,t){return e.id===t};W.on("message",(function(e){return k((function(t){return[].concat(Object(d.a)(t),[e])}))})),W.on("percent",(function(t,a){var n=a.id,c=a.user,r=a.type;k((function(a){var o=a.findIndex((function(t){return e(t,n)}));return o<0?function(e){var t=e.messages,a=e.id,n=e.upload,c=void 0===n?"":n,r=e.user,o=e.type,l=e.percent;return[].concat(Object(d.a)(t),[{id:a,upload:c,user:r,type:o,percent:l}])}({messages:a,id:n,percent:t,user:c,type:r}):(a[o].percent=t,Object(d.a)(a))}))})),W.on("file",(function(t){var a=t.user,n=t.upload,c=t.type,r=t.id;n&&k((function(t){return function(e,t,a){return t[e]=Object(f.a)(Object(f.a)({},t[e]),a),Object(d.a)(t)}(t.findIndex((function(t){return e(t,r)})),t,{id:r,user:a,upload:n,type:c})}))}))}),[]),Object(n.useEffect)((function(){W.on("roomData",(function(e){var t=e.users;U(t.length)}))}),[x]);return c.a.createElement(c.a.Fragment,null,c.a.createElement(C,{room:m,counts:x}),c.a.createElement(z,{messages:S,name:r}),c.a.createElement(y,{message:v,setMessage:O,sendMessage:function(e){e.preventDefault(),v&&W.emit("sendMessage",v,(function(){return O("")}))},sendFile:function(e){Y.process(e,W).then((function(e){e.send()}))},uploadFile:function(e){Y.process(e,W).then((function(e){return e.upload()}))}}))},X=(a(226),function(e){var t=e.title,a=e.content,n=e.control;return c.a.createElement("div",{className:"chat__box"},c.a.createElement("h1",null,t),a,c.a.createElement("div",null,n))});X.defaultProps={setHasNotification:function(){},hasNotification:!1};var Z,$=X,ee=a(263),te=a(264),ae=(a(227),function(){var e=Object(n.useState)(""),t=Object(i.a)(e,2),a=t[0],r=t[1],o=Object(n.useState)(""),s=Object(i.a)(o,2),u=s[0],m=s[1],f=Object(n.useState)(),d=Object(i.a)(f,2),p=d[0],h=d[1];return c.a.createElement($,{title:"Join",content:c.a.createElement(ee.a,null,c.a.createElement("input",{type:"file",onChange:function(e){h(URL.createObjectURL(e.target.files[0]))}}),c.a.createElement("img",{width:"50px",src:p}),c.a.createElement(ee.a.Group,{controlId:"formBasicPassword"},c.a.createElement(ee.a.Label,null,"Username"),c.a.createElement(ee.a.Control,{type:"text",placeholder:"Username",onChange:function(e){return r(e.target.value)}}),c.a.createElement(ee.a.Label,null,"Room"),c.a.createElement(ee.a.Control,{type:"text",placeholder:"Room",onChange:function(e){return m(e.target.value)}}))),control:c.a.createElement(l.b,{onClick:function(e){return a&&u?null:e.preventDefault()},to:"/chat?name=".concat(a,"&room=").concat(u)},c.a.createElement(te.a,{block:!0,type:"submit"},"Join In"))})}),ne=(a(229),a(58)),ce=a.n(ne);Z="https://dailytalk.herokuapp.com/api/auth/";var re=new(function(){function e(){Object(J.a)(this,e)}return Object(G.a)(e,[{key:"login",value:function(e,t){return ce.a.post(Z+"signin",{username:e,password:t}).then((function(e){return e.data.accessToken&&localStorage.setItem("user",JSON.stringify(e.data)),e.data}))}},{key:"logout",value:function(){localStorage.removeItem("user")}},{key:"signup",value:function(e,t,a,n){return ce.a.post(Z+"signup",{username:e,email:t,password:a,roles:n})}},{key:"getCurrentUser",value:function(){return JSON.parse(localStorage.getItem("user"))}}]),e}()),oe=(a(246),function(e){var t=Object(n.useContext)(u),a=Object(i.a)(t,2),r=(a[0],a[1]),o=Object(n.useState)(!1),l=Object(i.a)(o,2),m=l[0],f=l[1],d=Object(n.useState)(""),p=Object(i.a)(d,2),h=p[0],g=p[1],E=Object(n.useState)(""),b=Object(i.a)(E,2),v=b[0],O=b[1];if(!0===m)return c.a.createElement(s.a,{to:"join"});return c.a.createElement(c.a.Fragment,null,c.a.createElement($,{title:"Login",content:c.a.createElement(ee.a,null,c.a.createElement(ee.a.Group,{controlId:"formBasicName"},c.a.createElement(ee.a.Label,null,"Username"),c.a.createElement(ee.a.Control,{type:"text",placeholder:"Username",onChange:function(e){g(e.target.value)}})),c.a.createElement(ee.a.Group,{controlId:"formBasicPassword"},c.a.createElement(ee.a.Label,null,"Password"),c.a.createElement(ee.a.Control,{type:"password",placeholder:"Password",onChange:function(e){O(e.target.value)}}))),control:c.a.createElement(te.a,{onClick:function(e){e.preventDefault(),re.login(h,v).then((function(e){f(!0)})).catch((function(e){r({status:e.name,content:e.message}),setTimeout((function(){r({status:null,content:null})}),3e3)}))},variant:"primary",type:"submit"},"Submit")}))}),le=(a(247),function(e){var t=Object(n.useContext)(u),a=Object(i.a)(t,2),r=(a[0],a[1]),o=Object(n.useState)(""),l=Object(i.a)(o,2),m=l[0],f=l[1],d=Object(n.useState)(""),p=Object(i.a)(d,2),h=p[0],g=p[1],E=Object(n.useState)(""),b=Object(i.a)(E,2),v=b[0],O=b[1],j=Object(n.useState)(!1),y=Object(i.a)(j,2),_=y[0],S=y[1];return _?c.a.createElement(s.a,{to:"login"}):(console.log("process",Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0})),c.a.createElement($,{title:"Sign Up",content:c.a.createElement(ee.a,null,c.a.createElement(ee.a.Group,{controlId:"formBasicName"},c.a.createElement(ee.a.Label,null,"Username"),c.a.createElement(ee.a.Control,{type:"text",placeholder:"Normal text",onChange:function(e){f(e.target.value)},value:m})),c.a.createElement(ee.a.Group,{controlId:"formBasicEmail"},c.a.createElement(ee.a.Label,null,"Email address"),c.a.createElement(ee.a.Control,{type:"email",placeholder:"Enter email",onChange:function(e){g(e.target.value)},value:h})),c.a.createElement(ee.a.Group,{controlId:"formBasicPassword"},c.a.createElement(ee.a.Label,null,"Password"),c.a.createElement(ee.a.Control,{type:"password",placeholder:"Password",onChange:function(e){O(e.target.value)},value:v}))),control:c.a.createElement(te.a,{onClick:function(e){e.preventDefault(),re.signup(m,h,v,["user"]).then((function(e){S(!0)})).catch((function(e){r({status:e.name,content:e.message}),setTimeout((function(){r({status:null,content:null})}),3e3)}))},variant:"primary",type:"submit"},"Sign Up")}))}),se=(a(248),function(){return c.a.createElement("div",{className:"chat-home"},c.a.createElement("h1",null,"Fresh Talk"),c.a.createElement("div",{className:"chat-home__controls"},c.a.createElement(l.b,{to:"/signup"},"Sign up"),re.getCurrentUser()?c.a.createElement(l.b,{to:"/join"},"Join"):c.a.createElement(l.b,{to:"/login"},"Login")))}),ie=(a(249),function(e){var t=e.children,a=Object(n.useContext)(u),r=Object(i.a)(a,1)[0];return console.log("\u63d0\u793a",r),c.a.createElement("section",{className:"chat__head"},c.a.createElement("div",{className:"chat__notification chat__notification".concat("Error"===r.status?"--active":"")},r.content),c.a.createElement("div",{className:"chat__head-burgur"},t))}),ue=function(e){var t=e.component,a=Object(k.a)(e,["component"]);return c.a.createElement(s.b,Object.assign({},a,{render:function(e){return re.getCurrentUser()?c.a.createElement(t,e):c.a.createElement(s.a,{to:{pathname:"/login",state:{from:e.location}}})}}))},me=a(261),fe=(a(250),Object(s.h)((function(e){var t=e.history;return re.getCurrentUser()&&c.a.createElement(me.a,{size:"30",color:"#fff",onClick:function(){re.logout(),t.push("/")}},"Sign out")}))),de=(a(262),a(251),a(252),function(){return c.a.createElement(l.a,null,c.a.createElement(m,null,c.a.createElement(ie,null,c.a.createElement(fe,null)),c.a.createElement(s.d,null,c.a.createElement(s.b,{path:"/",exact:!0,component:se}),c.a.createElement(s.b,{path:"/Signup",component:le}),c.a.createElement(s.b,{path:"/login",component:oe}),c.a.createElement(ue,{path:"/join",component:ae}),c.a.createElement(ue,{path:"/chat",component:Q}),c.a.createElement(s.a,{from:"*",to:"/"}))))});o.a.render(c.a.createElement(de,null),document.querySelector("#root"))}},[[106,1,2]]]);
//# sourceMappingURL=main.df1ee45a.chunk.js.map