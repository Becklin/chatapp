(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{117:function(e,t,a){e.exports=a(268)},156:function(e,t){},159:function(e,t,a){},160:function(e,t,a){},163:function(e,t,a){},212:function(e,t,a){},213:function(e,t,a){},218:function(e,t){},220:function(e,t){},234:function(e,t,a){},242:function(e,t,a){},244:function(e,t,a){},261:function(e,t,a){},262:function(e,t,a){},263:function(e,t,a){},264:function(e,t,a){},265:function(e,t,a){},266:function(e,t,a){},267:function(e,t,a){},268:function(e,t,a){"use strict";a.r(t);var n=a(0),c=a.n(n),o=a(11),r=a.n(o),l=a(8),i=a(6),s=a(64),u=a(32),m=a(7),f=a(105),d=a.n(f),p=a(106),h=a.n(p),g=a(271),E=a(272),b=a(273),v=(a(159),function(e){var t=e.onHandleClick,a=e.className,n=e.name,o=e.disabled,r=e.icon,l="icon-".concat(n);return c.a.createElement("span",{className:"chat__icon ".concat(a," ").concat(o?"disabled":"")},c.a.createElement("label",{className:"chat__label",htmlFor:l},r&&r),c.a.createElement("input",{className:"hidden-input",type:"file",name:l,id:l,accept:"image/*,video/*,audio/*",onChange:function(e){var a=Array.from(e.target.files),n=new FormData;n.append(0,a[0]),t(n.get(0))}}))}),O=(a(160),function(e){var t=e.message,a=void 0===t?"":t,n=e.setMessage,o=e.sendMessage,r=e.sendFile,l=e.uploadFile;return console.log("\u4fe1\u606f",a),c.a.createElement("form",{className:"chat__form"},c.a.createElement("textarea",{className:"chat__message",placeholder:"write some message...",value:a,onChange:function(e){return n(e.target.value)},onKeyPress:function(e){return"Enter"===e.key?n(e.target.value):null}}),c.a.createElement("div",{className:"chat__controls"},c.a.createElement(v,{disabled:a,className:"chat__flex",type:"file",onHandleClick:r,icon:c.a.createElement(g.a,null),name:"files"}),c.a.createElement(v,{disabled:a,className:"chat__flex",type:"file",onHandleClick:l,icon:c.a.createElement(E.a,null),name:"upload"}),c.a.createElement(b.a,{className:"chat__flex",size:"32",onClick:a?function(e){o(e)}:null,color:a?"darkslategray":"#e3e3e3"})))}),y=a(274),j=a(275),_=(a(163),c.a.memo((function(e){var t=e.room,a=e.counts;return c.a.createElement("div",{className:"chat__infoBar"},c.a.createElement("div",{className:"chat__room"},c.a.createElement("h3",null,t)),c.a.createElement("div",{className:"chat__count"},a," ",c.a.createElement(y.a,{color:"#ffffff",size:24})),c.a.createElement("div",{className:"chat__back"},c.a.createElement(l.b,{to:"/"},c.a.createElement(j.a,{color:"white",size:24}))))}))),S=a(45),C=a(108),N=a.n(C),w=a(284),k=a(276),U=a(277),L=a(109),x=a.n(L),I=a(110),F=a.n(I),D=(a(212),function(e){e.message;var t=e.message,a=t.user,n=t.content,o=t.upload,r=t.type,l=t.address,i=t.percent,s=t.date,u=e.name,m=e.avatarSrc,f=!1,d=u.trim().toLowerCase();d===a&&(f=!0);var p=f?"user":"friend",h="user"===p?d:a;return c.a.createElement("div",{className:"chat-message chat-message--".concat(p)},"friend"===p&&c.a.createElement("h4",null,m?c.a.createElement(k.a,{src:m,roundedCircle:!0}):c.a.createElement(U.a,{size:24}),c.a.createElement("span",null,h)),c.a.createElement("div",{className:"chat-message__body"},function(e){if(e>0&&e<100)return c.a.createElement(c.a.Fragment,null,"loading...",c.a.createElement(w.a,{now:e,animated:!0}))}(i),c.a.createElement("span",{className:"chat-message__date"},F()(s).format("LTS")),function(e){var t=e.address,a=e.type,n=e.upload;if(t)return c.a.createElement("div",{dangerouslySetInnerHTML:{__html:t}});if(a&&n)switch(a){case"video/mp4":return c.a.createElement("video",{width:"100%",controls:!0},c.a.createElement("source",{src:"data:image/png;base64, ".concat(n),type:"video/mp4"}),c.a.createElement("source",{src:"data:image/png;base64, ".concat(n),type:"video/ogg"}),"Your browser does not support the video tag.");case"image/*":default:return c.a.createElement("img",{className:"img-thumbnail img-fluid",src:"data:image/png;base64, ".concat(n)})}}({address:l,percent:i,type:r,upload:o}),n&&c.a.createElement("p",{className:"chat-message__body--text"},x.a.emojify(n))))}),P=(a(213),c.a.memo((function(e){var t=e.messages,a=e.name,n=Object(S.a)(e,["messages","name"]);return c.a.createElement(N.a,{className:"chat__messages"},t.map((function(e){return c.a.createElement(D,Object.assign({key:"name-".concat(e.id),message:e,name:a},n))})))}))),B=a(43),R=a(44),T=a(20),z=a.n(T);function H(e,t,a){for(var n=e.split(","),c=n[0].match(/:(.*?);/)[1],o=atob(n[1]),r=o.length,l=new Uint8Array(r);r--;)l[r]=o.charCodeAt(r);return new File([l],t.name,{type:c})}var J,A=function(){function e(t,a,n){Object(B.a)(this,e),console.log("\u6a94\u6848",t),this.socket=a,this.file=t,this.name=t.name}return Object(R.a)(e,[{key:"send",value:function(){console.log("\u9001\u51fa",this,this.file.size);var e=z.a.createStream();z.a.createBlobReadStream(this.file).pipe(e),z()(this.socket).emit("sendFile",e,{name:this.file.name,type:this.file.type,size:this.file.size}),console.log("this.file",this.file)}},{key:"upload",value:function(){var e=z.a.createStream();z()(this.socket).emit("uploadFile",e,{name:this.file.name,type:this.file.type,size:this.file.size}),z.a.createBlobReadStream(this.file).pipe(e)}}],[{key:"process",value:function(t,a){var n=this,c={name:t.name,quality:.6,type:t.type};return G(t,c).then((function(e){var t=e.readerDataUrl,a=e.config;e.callback;switch(n.base64=t,console.log("\u8f49\u63db\u6210convertToDataUrl"),a.type){case"image/jpeg":case"video/mp4":return new Promise((function(e){e(H(t,a))}));default:alert("the type is not supprted")}})).then((function(t){return n.data=t,new e(n.data,a)}))}}]),e}(),G=function(e,t,a){return new Promise((function(n){var c=new FileReader;c.readAsDataURL(e),c.onload=function(){var e=this.result;console.log("\u52a0\u8f09\u958b\u59cb"),n({readerDataUrl:e,config:t,callback:a})},c.onloadend=function(){console.log("\u52a0\u8f09\u5df2\u7d93\u7d50\u675f")}}))},M=A,K=function(){var e=Object(i.g)().search,t=Object(n.useState)(""),a=Object(m.a)(t,2),o=a[0],r=a[1],l=Object(n.useState)(""),f=Object(m.a)(l,2),p=f[0],g=f[1],E=Object(n.useState)(null),b=Object(m.a)(E,2),v=b[0],y=b[1],j=Object(n.useState)([]),S=Object(m.a)(j,2),C=S[0],N=S[1],w=Object(n.useState)(0),k=Object(m.a)(w,2),U=k[0],L=k[1],x="localhost:5000";x="https://dailytalk.herokuapp.com",console.log(x),Object(n.useEffect)((function(){var t=d.a.parse(e),a=t.name,n=t.room;return J=h()(x,{path:"/socket.io",transports:["websocket"],secure:!0}),r(a),g(n),J.emit("join",{name:a,room:n},(function(e){e&&alert(e)})),function(){J.emit("disconnect"),J.off()}}),[x,e]),Object(n.useEffect)((function(){var e=function(e,t){return e.id===t};J.on("message",(function(e){return N((function(t){return[].concat(Object(u.a)(t),[e])}))})),J.on("percent",(function(t,a){var n=a.id,c=a.user,o=a.type;N((function(a){var r=a.findIndex((function(t){return e(t,n)}));return r<0?function(e){var t=e.messages,a=e.id,n=e.upload,c=void 0===n?"":n,o=e.user,r=e.type,l=e.percent;return[].concat(Object(u.a)(t),[{id:a,upload:c,user:o,type:r,percent:l}])}({messages:a,id:n,percent:t,user:c,type:o}):(a[r].percent=t,Object(u.a)(a))}))})),J.on("file",(function(t){var a=t.user,n=t.upload,c=t.type,o=t.id;n&&N((function(t){return function(e,t,a){return t[e]=Object(s.a)(Object(s.a)({},t[e]),a),Object(u.a)(t)}(t.findIndex((function(t){return e(t,o)})),t,{id:o,user:a,upload:n,type:c})}))}))}),[]),Object(n.useEffect)((function(){J.on("roomData",(function(e){var t=e.users;L(t.length)}))}),[U]);return c.a.createElement(c.a.Fragment,null,c.a.createElement(_,{room:p,counts:U}),c.a.createElement(P,{messages:C,name:o}),c.a.createElement(O,{message:v,setMessage:y,sendMessage:function(e){e.preventDefault(),v&&J.emit("sendMessage",v,(function(){return y("")}))},sendFile:function(e){M.process(e,J).then((function(e){e.send()}))},uploadFile:function(e){M.process(e,J).then((function(e){return e.upload()}))}}))},W=a(281),q=a(282),V=(a(234),function(e){var t=e.title,a=e.content,n=e.control,o=e.hasNotification,r=e.notificationContent,l=c.a.createElement(q.a,{node:document&&document.getElementById("portal")},c.a.createElement(W.a,{delay:3e3,autohide:!0},c.a.createElement(W.a.Header,null,c.a.createElement("strong",{className:"mr-auto"},"FAILURE")),c.a.createElement(W.a.Body,null,r)));return c.a.createElement("div",{className:"chat__box"},c.a.createElement("h1",null,t),a,c.a.createElement("div",null,n),o&&l)});V.defaultProps={setHasNotification:function(){},hasNotification:!1};var Y=V,Q=a(280),X=a(283),Z=(a(242),function(){var e=Object(n.useState)(""),t=Object(m.a)(e,2),a=t[0],o=t[1],r=Object(n.useState)(""),i=Object(m.a)(r,2),s=i[0],u=i[1],f=Object(n.useState)(),d=Object(m.a)(f,2),p=d[0],h=d[1];return c.a.createElement(Y,{title:"Join",content:c.a.createElement(Q.a,null,c.a.createElement("input",{type:"file",onChange:function(e){h(URL.createObjectURL(e.target.files[0]))}}),c.a.createElement("img",{width:"50px",src:p}),c.a.createElement(Q.a.Group,{controlId:"formBasicPassword"},c.a.createElement(Q.a.Label,null,"Username"),c.a.createElement(Q.a.Control,{type:"text",placeholder:"Username",onChange:function(e){return o(e.target.value)}}),c.a.createElement(Q.a.Label,null,"Room"),c.a.createElement(Q.a.Control,{type:"text",placeholder:"Room",onChange:function(e){return u(e.target.value)}}))),control:c.a.createElement(l.b,{onClick:function(e){return a&&s?null:e.preventDefault()},to:"/chat?name=".concat(a,"&room=").concat(s)},c.a.createElement(X.a,{block:!0,type:"submit"},"Join In"))})}),$=(a(244),a(31)),ee=a.n($),te="https://localhost:5000/api/auth/";te="https://dailytalk.herokuapp.com/api/auth/";var ae=new(function(){function e(){Object(B.a)(this,e)}return Object(R.a)(e,[{key:"login",value:function(e,t){return ee.a.post(te+"signin",{username:e,password:t}).then((function(e){return e.data.accessToken&&localStorage.setItem("user",JSON.stringify(e.data)),e.data}))}},{key:"logout",value:function(){localStorage.removeItem("user")}},{key:"signup",value:function(e,t,a){return ee.a.post(te+"signup",{username:e,email:t,password:a})}},{key:"getCurrentUser",value:function(){return JSON.parse(localStorage.getItem("user"))}}]),e}()),ne=(a(261),function(e){var t=Object(n.useState)(!1),a=Object(m.a)(t,2),o=a[0],r=a[1],l=Object(n.useState)(""),s=Object(m.a)(l,2),u=s[0],f=s[1],d=Object(n.useState)(""),p=Object(m.a)(d,2),h=p[0],g=p[1],E=Object(n.useState)(!1),b=Object(m.a)(E,2),v=b[0],O=b[1];if(!0===o)return c.a.createElement(i.a,{to:"join"});return c.a.createElement(c.a.Fragment,null,c.a.createElement(Y,{title:"Login",content:c.a.createElement(Q.a,null,c.a.createElement(Q.a.Group,{controlId:"formBasicName"},c.a.createElement(Q.a.Label,null,"Username"),c.a.createElement(Q.a.Control,{type:"text",placeholder:"Username",onChange:function(e){f(e.target.value)}})),c.a.createElement(Q.a.Group,{controlId:"formBasicPassword"},c.a.createElement(Q.a.Label,null,"Password"),c.a.createElement(Q.a.Control,{type:"password",placeholder:"Password",onChange:function(e){g(e.target.value)}}))),control:c.a.createElement(X.a,{onClick:function(e){e.preventDefault(),ae.login(u,h).then((function(e){console.log("\u8cc7\u6599",e),r(!0)})).catch((function(e){console.log("catch",e),O(!0)}))},variant:"primary",type:"submit"},"Submit"),hasNotification:v,notificationContent:"Oops, something went wrong!"}))}),ce=(a(262),function(e){var t=Object(n.useState)(""),a=Object(m.a)(t,2),o=a[0],r=a[1],l=Object(n.useState)(""),s=Object(m.a)(l,2),u=s[0],f=s[1],d=Object(n.useState)(""),p=Object(m.a)(d,2),h=p[0],g=p[1],E=Object(n.useState)(!1),b=Object(m.a)(E,2),v=b[0],O=b[1],y=Object(n.useState)(!1),j=Object(m.a)(y,2),_=j[0],S=j[1];return v?c.a.createElement(i.a,{to:"login"}):(console.log("process",Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0})),c.a.createElement(Y,{title:"Sign Up",content:c.a.createElement(Q.a,null,c.a.createElement(Q.a.Group,{controlId:"formBasicName"},c.a.createElement(Q.a.Label,null,"Username"),c.a.createElement(Q.a.Control,{type:"text",placeholder:"Normal text",onChange:function(e){r(e.target.value)},value:o})),c.a.createElement(Q.a.Group,{controlId:"formBasicEmail"},c.a.createElement(Q.a.Label,null,"Email address"),c.a.createElement(Q.a.Control,{type:"email",placeholder:"Enter email",onChange:function(e){f(e.target.value)},value:u})),c.a.createElement(Q.a.Group,{controlId:"formBasicPassword"},c.a.createElement(Q.a.Label,null,"Password"),c.a.createElement(Q.a.Control,{type:"password",placeholder:"Password",onChange:function(e){g(e.target.value)},value:h}))),control:c.a.createElement(X.a,{onClick:function(e){e.preventDefault(),ee.a.post("/api/auth/signup",{username:o,email:u,password:h,roles:["user"]}).then((function(e){O(!0)})).catch((function(e){console.log("catch",e),S(!0)}))},variant:"primary",type:"submit"},"Sign Up"),setHasNotification:S,hasNotification:_,notificationContent:"Oops, something went wrong!"}))}),oe=(a(263),function(){return c.a.createElement("div",{className:"chat-home"},c.a.createElement("h1",null,"Fresh Talk"),c.a.createElement("div",{className:"chat-home__controls"},c.a.createElement(l.b,{to:"/signup"},"Sign up"),ae.getCurrentUser()?c.a.createElement(l.b,{to:"/join"},"Join"):c.a.createElement(l.b,{to:"/login"},"Login")))}),re=(a(264),function(e){var t=e.children;return c.a.createElement("section",{className:"chat__head"},t)}),le=function(e){var t=e.component,a=Object(S.a)(e,["component"]);return c.a.createElement(i.b,Object.assign({},a,{render:function(e){return ae.getCurrentUser()?c.a.createElement(t,e):c.a.createElement(i.a,{to:{pathname:"/login",state:{from:e.location}}})}}))},ie=a(278),se=(a(265),Object(i.h)((function(e){var t=e.history;return ae.getCurrentUser()&&c.a.createElement(ie.a,{size:"30",color:"#fff",onClick:function(){ae.logout(),t.push("/")}},"Sign out")}))),ue=(a(279),a(266),a(267),function(){return c.a.createElement(l.a,null,c.a.createElement(re,null,c.a.createElement(se,null)),c.a.createElement(i.d,null,c.a.createElement(i.b,{path:"/",exact:!0,component:oe}),c.a.createElement(i.b,{path:"/Signup",component:ce}),c.a.createElement(i.b,{path:"/login",component:ne}),c.a.createElement(le,{path:"/join",component:Z}),c.a.createElement(le,{path:"/chat",component:K}),c.a.createElement(i.a,{from:"*",to:"/"})),c.a.createElement("div",{id:"portal"}))});r.a.render(c.a.createElement(ue,null),document.querySelector("#root"))}},[[117,1,2]]]);
//# sourceMappingURL=main.308b21c9.chunk.js.map