(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{162:function(e,t){},165:function(e,t,n){},166:function(e,t,n){},218:function(e,t,n){},219:function(e,t,n){},226:function(e,t){},228:function(e,t){},242:function(e,t,n){},244:function(e,t,n){},261:function(e,t,n){},262:function(e,t,n){},263:function(e,t,n){},264:function(e,t,n){},265:function(e,t,n){},266:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),o=n(109),s=n.n(o),r=n(19),i=n(8),l=n(1),u=n(110),j=n.n(u),b=n(7),p=Object(a.createContext)(),f=function(e){var t=e.children,n=Object(a.useState)({}),c=Object(b.a)(n,2),o=c[0],s=c[1];return Object(l.jsx)(p.Provider,{value:[o,s]},t)},d=n(72),m=n(38),O=n(111),x=n.n(O),g=n(112),h=n.n(g),v=n(267),y=n(268),_=n(269),w=(n(165),function(e){var t=e.onHandleClick,n=e.className,a=e.name,c=e.disabled,o=e.icon,s="icon-".concat(a);return Object(l.jsx)("span",{className:"chat__icon ".concat(n," ").concat(c?"disabled":"")},Object(l.jsx)("label",{className:"chat__label",htmlFor:s},o&&o),Object(l.jsx)("input",{className:"hidden-input",type:"file",name:s,id:s,accept:"image/*,video/*,audio/*",onChange:function(e){var n=Array.from(e.target.files),a=new FormData;a.append(0,n[0]),t(a.get(0))}}))}),k=(n(166),function(e){var t=e.message,n=void 0===t?"":t,a=e.setMessage,c=e.sendMessage,o=e.sendFile,s=e.uploadFile;return Object(l.jsx)("form",{className:"chat__form"},Object(l.jsx)("textarea",{className:"chat__message",placeholder:"write some message...",value:n,onChange:function(e){return a(e.target.value)},onKeyPress:function(e){return"Enter"===e.key?a(e.target.value):null}}),Object(l.jsx)("div",{className:"chat__controls"},Object(l.jsx)(w,{disabled:n,className:"chat__flex",type:"file",onHandleClick:o,icon:Object(l.jsx)(v.a,null),name:"files"}),Object(l.jsx)(w,{disabled:n,className:"chat__flex",type:"file",onHandleClick:s,icon:Object(l.jsx)(y.a,null),name:"upload"}),Object(l.jsx)(_.a,{className:"chat__flex",size:"32",onClick:n?function(e){c(e)}:null,color:n?"darkslategray":"#e3e3e3"})))}),S=n(11),C=n(270),N=n(271);var U={name:"ojolip",styles:"padding:16px;background:#007bff;border-radius:5px;margin:8px;color:#ffffff;display:inline-block"},z=function(){return U},L=Object(S.a)(r.b,{target:"e9946jg0"})("&:focus,&:hover,&:visited,&:link,&:active{text-decoration:none;color:#2A3346,display:flex;justify-content:center;",(function(e){return e.primary&&z}),";&>svg{margin:0 8px;}}"),F=function(e){var t=e.to,n=e.icon,a=e.width,c=e.children,o=e.disabled,s=e.primary;return Object(l.jsx)(L,{width:a,to:t,disabled:o,primary:s&&s.toString()},n,c)};F.defaultProps={icon:null};var I=F,P="#ECECEE",E="#2A3346",B="#808187",D="radial-gradient(circle, rgba(238,238,238,1) 0%, rgba(255,255,255,1) 100%)",J=Object(S.a)("div",{target:"e6qepj40"})("display:flex;align-items:center;padding:0 50px 0 12px;& .chat__room{width:100px;flex:5;color:",E,";}& .chat__count{width:100px;flex:1;color:",E,";}& .chat__back{width:100px;flex:1;}"),R=function(e){var t=e.room,n=e.counts;return Object(l.jsx)(J,null,Object(l.jsx)("div",{className:"chat__room"},Object(l.jsx)("h3",null,t)),Object(l.jsx)("div",{className:"chat__count"},n," ",Object(l.jsx)(C.a,{color:E,size:24})),Object(l.jsx)("div",{className:"chat__back"},Object(l.jsx)(I,{to:"/",icon:Object(l.jsx)(N.a,{color:E,size:24})})))},G=c.a.memo(R),q=n(48),A=n(51),M=n(113),T=n.n(M),H=n(281),K=n(272),Y=n(273),Q=n(114),V=n.n(Q),W=n(115),X=n.n(W),Z=(n(218),function(e){var t=e.message,n=e.name,a=e.avatarSrc,o=t.user,s=t.content,r=t.upload,i=t.type,u=t.address,j=t.percent,b=t.date,p=!1,f=n.trim().toLowerCase();f===o&&(p=!0);var d=p?"user":"friend",m="user"===d?f:o;return Object(l.jsx)("div",{className:"chat-message chat-message--".concat(d)},"friend"===d&&Object(l.jsx)("h4",null,a?Object(l.jsx)(K.a,{src:a,roundedCircle:!0}):Object(l.jsx)(Y.a,{size:24}),Object(l.jsx)("span",null,m)),Object(l.jsx)("div",{className:"chat-message__body"},function(e){if(e>0&&e<100)return Object(l.jsx)(c.a.Fragment,null,"loading...",Object(l.jsx)(H.a,{now:e,animated:!0}))}(j),Object(l.jsx)("span",{className:"chat-message__date"},X()(b).format("LTS")),function(e){var t=e.address,n=e.type,a=e.upload;if(t)return Object(l.jsx)("div",{dangerouslySetInnerHTML:{__html:t}});if(n&&a)switch(n){case"video/mp4":return Object(l.jsx)("video",{width:"100%",controls:!0},Object(l.jsx)("source",{src:"data:image/png;base64, ".concat(a),type:"video/mp4"}),Object(l.jsx)("source",{src:"data:image/png;base64, ".concat(a),type:"video/ogg"}),"Your browser does not support the video tag.");case"image/*":default:return Object(l.jsx)("img",{className:"img-thumbnail img-fluid",src:"data:image/png;base64, ".concat(a)})}}({address:u,percent:j,type:i,upload:r}),s&&Object(l.jsx)("p",{className:"chat-message__body--text"},V.a.emojify(s))))}),$=(n(219),function(e){var t=e.messages,n=e.name,a=Object(A.a)(e,["messages","name"]);return Object(l.jsx)(T.a,{className:"chat__messages"},t.map((function(e){return Object(l.jsx)(Z,Object(q.a)({key:"name-".concat(e.id),message:e,name:n},a))})))}),ee=c.a.memo($),te=n(70),ne=n.n(te),ae=n(116),ce=n(49),oe=n(50),se=n(24),re=n.n(se);function ie(e,t){for(var n=e.split(","),a=n[0].match(/:(.*?);/)[1],c=atob(n[1]),o=c.length,s=new Uint8Array(o);o--;)s[o]=c.charCodeAt(o);return new File([s],t.name,{type:a})}var le,ue=function(){function e(t,n){Object(ce.a)(this,e),this.socket=n,this.file=t,this.name=t.name}return Object(oe.a)(e,[{key:"send",value:function(){var e=re.a.createStream();re.a.createBlobReadStream(this.file).pipe(e),re()(this.socket).emit("sendFile",e,{name:this.file.name,type:this.file.type,size:this.file.size})}},{key:"upload",value:function(){var e=re.a.createStream();re()(this.socket).emit("uploadFile",e,{name:this.file.name,type:this.file.type,size:this.file.size}),re.a.createBlobReadStream(this.file).pipe(e)}}],[{key:"process",value:function(t,n){var a=this,c={name:t.name,quality:.6,type:t.type};return je(t,c).then((function(e){var t=e.readerDataUrl,n=e.config;e.callback;switch(a.base64=t,n.type){case"image/jpeg":case"video/mp4":return new Promise((function(e){e(ie(t,n))}));default:alert("the type is not supprted")}})).then((function(t){return a.data=t,new e(a.data,n)}))}}]),e}(),je=function(){var e=Object(ae.a)(ne.a.mark((function e(t,n,a){var c;return ne.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=function(e,t,n){return new Promise((function(a,c){var o=new FileReader;o.readAsDataURL(e),o.onload=function(){var e=this.result;a({readerDataUrl:e,config:t,callback:n})},o.onerror=function(){return c("\u52a0\u8f7d\u5931\u8d25")},o.onloadend=function(){console.log("\u52a0\u8f09\u5df2\u7d93\u7d50\u675f")}}))},e.next=3,c(t,n,a);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),be=ue,pe=function(){var e=Object(i.g)().search,t=Object(a.useState)(""),n=Object(b.a)(t,2),o=n[0],s=n[1],r=Object(a.useState)(""),u=Object(b.a)(r,2),j=u[0],p=u[1],f=Object(a.useState)(null),O=Object(b.a)(f,2),g=O[0],v=O[1],y=Object(a.useState)([]),_=Object(b.a)(y,2),w=_[0],S=_[1],C=Object(a.useState)(0),N=Object(b.a)(C,2),U=N[0],z=N[1],L="localhost:5000";L="https://dailytalk.herokuapp.com",Object(a.useEffect)((function(){var t=x.a.parse(e),n=t.name,a=t.room;return le=h()(L,{path:"/socket.io",transports:["websocket"],secure:!0}),s(n),p(a),le.emit("join",{name:n,room:a},(function(e){e&&alert(e)})),function(){le.emit("disconnect"),le.off()}}),[L,e]),Object(a.useEffect)((function(){var e=function(e,t){return e.id===t};le.on("message",(function(e){return S((function(t){return[].concat(Object(m.a)(t),[e])}))})),le.on("percent",(function(t,n){var a=n.id,c=n.user,o=n.type;S((function(n){var s=n.findIndex((function(t){return e(t,a)}));return s<0?function(e){var t=e.messages,n=e.id,a=e.upload,c=void 0===a?"":a,o=e.user,s=e.type,r=e.percent;return[].concat(Object(m.a)(t),[{id:n,upload:c,user:o,type:s,percent:r}])}({messages:n,id:a,percent:t,user:c,type:o}):(n[s].percent=t,Object(m.a)(n))}))})),le.on("file",(function(t){var n=t.user,a=t.upload,c=t.type,o=t.id;a&&S((function(t){return function(e,t,n){return t[e]=Object(d.a)(Object(d.a)({},t[e]),n),Object(m.a)(t)}(t.findIndex((function(t){return e(t,o)})),t,{id:o,user:n,upload:a,type:c})}))}))}),[]),Object(a.useEffect)((function(){le.on("roomData",(function(e){var t=e.users;z(t.length)}))}),[U]);return Object(l.jsx)(c.a.Fragment,null,Object(l.jsx)(G,{room:j,counts:U}),Object(l.jsx)(ee,{messages:w,name:o}),Object(l.jsx)(k,{message:g,setMessage:v,sendMessage:function(e){e.preventDefault(),console.log(g),g&&le.emit("sendMessage",g,(function(){return v("")}))},sendFile:function(e){be.process(e,le).then((function(e){e.send()}))},uploadFile:function(e){be.process(e,le).then((function(e){return e.upload()}))}}))};var fe=Object(S.a)("div",{target:"ebsbl961"})({name:"o0zptl",styles:"width:300px;margin:0;position:absolute;top:45%;left:50%;transform:translate(-50%, -50%)"}),de=Object(S.a)("div",{target:"ebsbl960"})({name:"1khfev6",styles:"margin:12px 0px"}),me=function(e){var t=e.title,n=e.content,a=e.control,c=e.notification;return Object(l.jsx)(fe,{className:"chat__box"},Object(l.jsx)("div",null,c.content),Object(l.jsx)(De,null,t),n,Object(l.jsx)(de,null,a))};me.defaultProps={notification:{content:"",type:null}};var Oe=me,xe=n(279),ge=(n(242),function(){var e=Object(a.useState)(""),t=Object(b.a)(e,2),n=t[0],c=t[1],o=Object(a.useState)(""),s=Object(b.a)(o,2),r=s[0],i=s[1],u=Object(a.useState)(),j=Object(b.a)(u,2),p=j[0],f=j[1],d=n&&r,m=Object(S.a)("input",{target:"e5q3xhq0"})("color:transparent;position:relative;height:50px;margin-left:-140px;margin-top:16px;margin-bottom:16px;&::before{content:'Select some files';display:inline-block;background:",P,";color:",B,";border-radius:3px;padding:0px 8px;outline:none;cursor:pointer;width:140px;height:50px;position:absolute;left:140px;line-height:50px;}");return Object(l.jsx)(Oe,{title:"Join",content:Object(l.jsx)(xe.a,null,Object(l.jsx)(m,{type:"file",onChange:function(e){f(URL.createObjectURL(e.target.files[0]))}}),Object(l.jsx)("img",{width:"50px",src:p}),Object(l.jsx)(xe.a.Group,{controlId:"formBasicPassword"},Object(l.jsx)(xe.a.Label,null,"Username"),Object(l.jsx)(xe.a.Control,{type:"text",placeholder:"Username",onChange:function(e){return c(e.target.value)}}),Object(l.jsx)(xe.a.Label,null,"Room"),Object(l.jsx)(xe.a.Control,{type:"text",placeholder:"Room",onChange:function(e){return i(e.target.value)}}))),control:Object(l.jsx)(I,{primary:!0,disabled:d,width:"90%",to:"/chat?name=".concat(n,"&room=").concat(r)},"Join In")})}),he=(n(244),n(280)),ve=n(71),ye=n.n(ve),_e="/api/auth/";_e="https://dailytalk.herokuapp.com/api/auth/";var we=new(function(){function e(){Object(ce.a)(this,e)}return Object(oe.a)(e,[{key:"login",value:function(e,t){return ye.a.post(_e+"signin",{username:e,password:t}).then((function(e){return e.data.accessToken&&localStorage.setItem("user",JSON.stringify(e.data)),e.data})).catch((function(e){console.log("login err",e)}))}},{key:"logout",value:function(){localStorage.removeItem("user")}},{key:"signup",value:function(e,t,n){return ye.a.post(_e+"signup",{username:e,email:t,password:n})}},{key:"getCurrentUser",value:function(){return console.log(JSON.parse(localStorage.getItem("user"))),JSON.parse(localStorage.getItem("user"))}}]),e}()),ke=(n(261),function(){var e=Object(i.g)().state,t=Object(a.useContext)(p),n=Object(b.a)(t,2),o=n[0],s=n[1],r=Object(a.useState)(!1),u=Object(b.a)(r,2),j=u[0],f=u[1],d=Object(a.useState)(""),m=Object(b.a)(d,2),O=m[0],x=m[1],g=Object(a.useState)(""),h=Object(b.a)(g,2),v=h[0],y=h[1],_=(e||{from:{pathname:"/"}}).from;if(!0===j)return Object(l.jsx)(i.a,{to:_});return Object(l.jsx)(c.a.Fragment,null,Object(l.jsx)(Oe,{title:"Login",notification:o,content:Object(l.jsx)(xe.a,null,Object(l.jsx)(xe.a.Group,{controlId:"formBasicName"},Object(l.jsx)(xe.a.Label,null,"Username"),Object(l.jsx)(xe.a.Control,{type:"text",placeholder:"Username",onChange:function(e){x(e.target.value)}})),Object(l.jsx)(xe.a.Group,{controlId:"formBasicPassword"},Object(l.jsx)(xe.a.Label,null,"Password"),Object(l.jsx)(xe.a.Control,{type:"password",placeholder:"Password",onChange:function(e){y(e.target.value)}}))),control:Object(l.jsx)(he.a,{onClick:function(e){e.preventDefault(),we.login(O,v).then((function(){f(!0)})).catch((function(e){s({status:e.name,content:e.message}),setTimeout((function(){s({status:null,content:null})}),3e3)}))},variant:"primary",type:"submit"},"Submit")}))}),Se=function(){var e=Object(a.useContext)(p),t=Object(b.a)(e,2),n=t[0],c=t[1],o=Object(a.useState)(""),s=Object(b.a)(o,2),r=s[0],u=s[1],j=Object(a.useState)(""),f=Object(b.a)(j,2),d=f[0],m=f[1],O=Object(a.useState)(""),x=Object(b.a)(O,2),g=x[0],h=x[1],v=Object(a.useState)(!1),y=Object(b.a)(v,2),_=y[0],w=y[1];return _?Object(l.jsx)(i.a,{to:"login"}):Object(l.jsx)(Oe,{notification:n,title:"Sign Up",content:Object(l.jsx)(xe.a,null,Object(l.jsx)(xe.a.Group,{controlId:"formBasicName"},Object(l.jsx)(xe.a.Label,null,"Username"),Object(l.jsx)(xe.a.Control,{type:"text",placeholder:"Normal text",onChange:function(e){u(e.target.value)},value:r})),Object(l.jsx)(xe.a.Group,{controlId:"formBasicEmail"},Object(l.jsx)(xe.a.Label,null,"Email address"),Object(l.jsx)(xe.a.Control,{type:"email",placeholder:"Enter email",onChange:function(e){m(e.target.value)},value:d})),Object(l.jsx)(xe.a.Group,{controlId:"formBasicPassword"},Object(l.jsx)(xe.a.Label,null,"Password"),Object(l.jsx)(xe.a.Control,{type:"password",placeholder:"Password",onChange:function(e){h(e.target.value)},value:g}))),control:Object(l.jsx)(he.a,{onClick:function(e){e.preventDefault(),we.signup(r,d,g,["user"]).then((function(){w(!0)})).catch((function(e){c({status:e.name,content:e.message}),setTimeout((function(){c({status:null,content:null})}),3e3)}))},variant:"primary",type:"submit"},"Sign Up")})},Ce=n(274),Ne=n(275),Ue=n(276);var ze=Object(S.a)("div",{target:"e1n90z1m0"})({name:"131sqdc",styles:"display:flex;background:radial-gradient(circle, rgba(238,238,238,1) 0%, rgba(255,255,255,1) 100%);flex-direction:column;justify-content:center;align-items:center;height:100vh"}),Le=function(){return Object(l.jsx)(ze,null,Object(l.jsx)(De,null,"Fresh Talk"),Object(l.jsx)("div",{className:"chat-home__controls"},Object(l.jsx)(I,{primary:!0,width:"120px",to:"/signup",icon:Object(l.jsx)(Ce.a,{size:"24"})},"Sign up"),we.getCurrentUser()?Object(l.jsx)(I,{primary:!0,width:"120px",to:"/join",icon:Object(l.jsx)(Ne.a,{size:"24"})},"Join"):Object(l.jsx)(I,{primary:!0,width:"120px",to:"/login",icon:Object(l.jsx)(Ue.a,{size:"24"})},"Login")))},Fe=(n(262),function(e){var t=e.children,n=Object(a.useContext)(p),c=Object(b.a)(n,1)[0];return Object(l.jsx)("section",{className:"chat__head"},Object(l.jsx)("div",{className:"chat__notification chat__notification".concat("Error"===c.status?"--active":"")},c.content),Object(l.jsx)("div",{className:"chat__head-burgur"},t))}),Ie=function(e){var t=e.component,n=e.location,a=Object(A.a)(e,["component","location"]);return console.log("location",n),Object(l.jsx)(i.b,Object(q.a)({},a,{render:function(e){return we.getCurrentUser()?Object(l.jsx)(t,e):Object(l.jsx)(i.a,{to:{pathname:"/login",state:{from:n}}})}}))},Pe=n(277),Ee=(n(263),Object(i.h)((function(e){var t=e.history;return we.getCurrentUser()&&Object(l.jsx)(Pe.a,{size:"30",color:"#fff",onClick:function(){we.logout(),t.push("/")}},"Sign out")})));n(278),n(264);var Be=Object(S.a)("h1",{target:"e19mlojp0"})({name:"8rnz4n",styles:"font-weight:200;letter-spacing:12px"}),De=function(e){var t=e.children;return Object(l.jsx)(Be,null,t)},Je=(n(265),function(){return Object(l.jsx)(r.a,null,Object(l.jsx)(f,null,Object(l.jsx)(l.Global,{styles:Object(l.css)(j.a," html,body{padding:0;margin:0;background:",D,";color:",B,";min-height:100%;overscroll-behavior-y:contain;}","")}),Object(l.jsx)(Fe,null,Object(l.jsx)(Ee,null)),Object(l.jsx)(i.d,null,Object(l.jsx)(i.b,{path:"/",exact:!0,component:Le}),Object(l.jsx)(i.b,{path:"/Signup",component:Se}),Object(l.jsx)(i.b,{path:"/login",component:ke}),Object(l.jsx)(Ie,{path:"/join",component:ge}),Object(l.jsx)(Ie,{path:"/chat",component:pe}),Object(l.jsx)(i.a,{from:"*",to:"/"}))))});s.a.render(Object(l.jsx)(Je,null),document.querySelector("#root"))}},[[266,1,2]]]);
//# sourceMappingURL=main.bb1a1cdd.chunk.js.map