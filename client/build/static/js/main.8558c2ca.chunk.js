(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{115:function(e,t,a){e.exports=a(256)},154:function(e,t){},157:function(e,t,a){},158:function(e,t,a){},159:function(e,t,a){},209:function(e,t,a){},210:function(e,t,a){},215:function(e,t){},217:function(e,t){},231:function(e,t,a){},232:function(e,t,a){},250:function(e,t,a){},251:function(e,t,a){},252:function(e,t,a){},253:function(e,t,a){},254:function(e,t,a){},255:function(e,t,a){},256:function(e,t,a){"use strict";a.r(t);var n,c=a(0),o=a.n(c),r=a(24),i=a.n(r),l=a(8),s=a(6),u=a(263),m=a(258),f=a(58),d=a(7),p=a(100),h=a.n(p),E=a(101),g=a.n(E),b=a(102),v=a(266),y=(a(157),function(e){e.type;var t=e.onHandleFile;return o.a.createElement("div",{className:"button"},o.a.createElement("input",{type:"file",id:"single",accept:"image/*,video/*,audio/*",onChange:function(e){var a=Array.from(e.target.files),n=new FormData;n.append(0,a[0]),t(n.get(0))}}))}),j=(a(158),function(e){var t=e.message,a=e.setMessage,n=e.sendMessage,c=e.sendFile,r=e.uploadFile;return o.a.createElement("form",{className:"chat__form"},o.a.createElement(m.a,null,o.a.createElement(b.a,{xs:8},o.a.createElement("input",{className:"chat__input",value:t,onChange:function(e){return a(e.target.value)},onKeyPress:function(e){return"Enter"===e.key?a(e.target.value):null}})),o.a.createElement(b.a,{xs:4},o.a.createElement(v.a,{disabled:!t,size:"sm",onClick:function(e){return n(e)}},"send"),o.a.createElement(y,{size:"sm",type:"sendFile",onHandleFile:c},"Files"),o.a.createElement(y,{size:"sm",type:"upload",onHandleFile:r},"Files"))))}),O=a(259),w=a(260),C=(a(159),o.a.memo((function(e){var t=e.room,a=e.counts;return o.a.createElement(m.a,{className:"chat__infoBar"},o.a.createElement(b.a,{xs:7},o.a.createElement("h3",null,t)),o.a.createElement(b.a,{xs:3},a," ",o.a.createElement(O.a,{color:"#ffffff",size:24})),o.a.createElement(b.a,{xs:2},o.a.createElement(l.b,{to:"/"},o.a.createElement(w.a,{color:"white",size:24}))))}))),S=a(104),_=a.n(S),N=a(261),k=a(262),x=a(105),F=a.n(x),D=(a(209),function(e){var t=e.message,a=t.user,n=t.text,c=t.upload,r=t.type,i=t.address,l=e.name,s=e.avatarSrc,u=!1,m=l.trim().toLowerCase();m===a&&(u=!0);var f=u?"user":"friend",d="user"===f?m:a;return o.a.createElement("div",{className:"chat-message__wrapper"},o.a.createElement("div",{className:"chat-message__userInfo chat-message__userInfo--".concat(f)},o.a.createElement("span",{className:"chat-message__avatar"},s?o.a.createElement(N.a,{src:s,roundedCircle:!0}):o.a.createElement(k.a,{size:24})),o.a.createElement("span",null,d),o.a.createElement("div",{className:"chat-message__content chat-message__content--".concat(f)},function(e,t){if(e)return o.a.createElement("div",{dangerouslySetInnerHTML:{__html:e}});if(t)switch(t){case"video/mp4":case"video/quicktime":return o.a.createElement("video",{controls:!0},o.a.createElement("source",{src:"data:image/png;base64, ".concat(c),type:"video/mp4"}),o.a.createElement("source",{src:"data:image/png;base64, ".concat(c),type:"video/ogg"}),"Your browser does not support the video tag.");case"image/*":default:return o.a.createElement("img",{className:"img-thumbnail img-fluid",src:"data:image/png;base64, ".concat(c)})}return o.a.createElement("p",{className:"chat-message__content--text"},F.a.emojify(n))}(i,r))))}),A=(a(210),o.a.memo((function(e){var t=e.messages,a=e.name;return o.a.createElement(_.a,{className:"chat__messages"},t.map((function(e,t){return o.a.createElement(D,{key:"name-".concat(t),message:e,name:a})})))}))),M=a(106),L=a(107),P=a(14),z=a.n(P),I=function(){function e(t,a,n){Object(M.a)(this,e),this.socket=a,this.file=t,this.name=t.name}return Object(L.a)(e,[{key:"send",value:function(){var e=z.a.createStream();z()(this.socket).emit("sendFile",e,{name:this.file.name,type:this.file.type,size:this.file.size});z.a.createBlobReadStream(this.file).pipe(e)}},{key:"upload",value:function(){var e=z.a.createStream();z()(this.socket).emit("uploadFile",e,{name:this.file.name,type:this.file.type,size:this.file.size});z.a.createBlobReadStream(this.file).pipe(e)}}],[{key:"process",value:function(t,a){var n=this,c={name:t.name,quality:.6};return B(t,c).then((function(e){var t=e.readerData,a=e.config,c=e.callback;return n.base64=t,R(t,a,c)})).then((function(e){var t=e.base64,a=e.config,c=e.callback;return n.minifiedBase64=t,H(t,a,c)})).then((function(t){return n.minifiedFile=t,new e(n.minifiedFile,a)}))}}]),e}(),B=function(e,t,a){return console.log("\u958b\u59cb",e),new Promise((function(n){var c=new FileReader;c.readAsDataURL(e),c.onload=function(){var e=this.result;n({readerData:e,config:t,callback:a})},c.onloadend=function(){console.log("\u52a0\u8f09\u5df2\u7d93\u7d50\u675f")}}))},R=function(e,t,a){return new Promise((function(n){var c=new Image;c.src=e,c.onload=function(){var e=400/(c.width/c.height),o=.7,r=document.createElement("canvas"),i=r.getContext("2d"),l=document.createAttribute("width");l.nodeValue=400;var s=document.createAttribute("height");s.nodeValue=e,r.setAttributeNode(l),r.setAttributeNode(s),i.drawImage(c,0,0,400,e),t.quality&&t.quality<=1&&t.quality>0&&(o=t.quality);var u=r.toDataURL("image/jpeg","image/webp",o);n({base64:u,config:t,callback:a})}}))},H=function(e,t){for(var a=e.split(","),n=a[0].match(/:(.*?);/)[1],c=atob(a[1]),o=c.length,r=new Uint8Array(o);o--;)r[o]=c.charCodeAt(o);return new File([r],t.name,{type:n})},U=I,q=function(){var e=Object(s.g)().search,t=Object(c.useState)(""),a=Object(d.a)(t,2),r=a[0],i=a[1],l=Object(c.useState)(""),m=Object(d.a)(l,2),p=m[0],E=m[1],b=Object(c.useState)(""),v=Object(d.a)(b,2),y=v[0],O=v[1],w=Object(c.useState)([]),S=Object(d.a)(w,2),_=S[0],N=S[1],k=Object(c.useState)(0),x=Object(d.a)(k,2),F=x[0],D=x[1],M="https://dailyeasychat.herokuapp.com";Object(c.useEffect)((function(){var t=h.a.parse(e),a=t.name,c=t.room;return n=g()(M),i(a),E(c),n.emit("join",{name:a,room:c},(function(e){e&&alert(e)})),function(){n.emit("disconnect"),n.off()}}),[M,e]),Object(c.useEffect)((function(){n.on("message",(function(e){N((function(t){return[].concat(Object(f.a)(t),[e])}))})),n.on("file",(function(e){var t=e.user,a=e.upload,n=e.type;a&&N((function(e){return[].concat(Object(f.a)(e),[{user:t,upload:a,type:n}])}))}))}),[]),Object(c.useEffect)((function(){n.on("roomData",(function(e){var t=e.users;D(t.length)}))}),[F]);return o.a.createElement(u.a,{fluid:!0},o.a.createElement(C,{room:p,counts:F}),o.a.createElement(A,{messages:_,name:r}),o.a.createElement(j,{message:y,setMessage:O,sendMessage:function(e){e.preventDefault(),y&&n.emit("sendMessage",y,(function(){return O("")}))},sendFile:function(e){U.process(e,n).then((function(e){e.send()}))},uploadFile:function(e){U.process(e,n).then((function(e){e.upload()}))}}))},Q=a(265),W=(a(231),a(21)),G=function(){var e=Object(W.useMediaQuery)({minDeviceWidth:1224}),t=Object(W.useMediaQuery)({minDeviceWidth:1824}),a=Object(W.useMediaQuery)({maxWidth:1224}),n=Object(W.useMediaQuery)({maxDeviceWidth:1224}),c=Object(W.useMediaQuery)({orientation:"portrait"}),o=Object(W.useMediaQuery)({minResolution:"2dppx"});return console.log("fff",e,t,a,n,c,o),{isDesktopOrLaptop:e,isBigScreen:t,isTabletOrMobile:a,isTabletOrMobileDevice:n,isPortrait:c,isRetina:o}},J=function(e){var t=e.title,a=e.content,n=e.control,c=e.setHasNotification,r=e.hasNotification,i=e.notificationContent;G();return o.a.createElement("div",{className:"chat__box"},o.a.createElement("h1",null,t),a,o.a.createElement("div",null,n),o.a.createElement(Q.a,{onClose:function(){return c(!1)},show:r,delay:3e3,autohide:!0},o.a.createElement(Q.a.Header,null,o.a.createElement("img",{src:"holder.js/20x20?text=%20",className:"rounded mr-2",alt:""}),o.a.createElement("strong",{className:"mr-auto"},"FAILURE"),o.a.createElement("small",null,"11 mins ago")),o.a.createElement(Q.a.Body,null,i)))};J.defaultProps={setHasNotification:function(){},hasNotification:!1};var T=J,V=a(264),K=(a(232),function(){var e=Object(c.useState)(""),t=Object(d.a)(e,2),a=t[0],n=t[1],r=Object(c.useState)(""),i=Object(d.a)(r,2),s=i[0],u=i[1];return o.a.createElement(T,{title:"Join",content:o.a.createElement(V.a,null,o.a.createElement(V.a.Group,{controlId:"formBasicPassword"},o.a.createElement(V.a.Label,null,"Username"),o.a.createElement(V.a.Control,{type:"text",placeholder:"Username",onChange:function(e){return n(e.target.value)}}),o.a.createElement(V.a.Label,null,"Room"),o.a.createElement(V.a.Control,{type:"text",placeholder:"Room",onChange:function(e){return u(e.target.value)}}))),control:o.a.createElement(l.b,{onClick:function(e){return a&&s?null:e.preventDefault()},to:"/chat?name=".concat(a,"&room=").concat(s)},o.a.createElement(v.a,{block:!0,type:"submit"},"Join In"))})}),Y={isAuthenticated:!1,authenticate:function(e){this.isAuthenticated=!0,e()},signout:function(e){this.isAuthenticated=!1,e()}},X=a(39),Z=a.n(X),$=(a(250),function(e){var t=Object(c.useState)(!1),a=Object(d.a)(t,2),n=a[0],r=a[1],i=Object(c.useState)(""),l=Object(d.a)(i,2),u=l[0],m=l[1],f=Object(c.useState)(""),p=Object(d.a)(f,2),h=p[0],E=p[1],g=Object(c.useState)(!1),b=Object(d.a)(g,2),y=b[0],j=b[1];(e.location.state||{from:{pathname:"/"}}).from;if(!0===n)return o.a.createElement(s.a,{to:"join"});return o.a.createElement(T,{title:"Login",content:o.a.createElement(V.a,null,o.a.createElement(V.a.Control,{type:"text",placeholder:"Username",onChange:function(e){m(e.target.value)}}),o.a.createElement(V.a.Group,{controlId:"formBasicPassword"},o.a.createElement(V.a.Label,null,"Password"),o.a.createElement(V.a.Control,{type:"password",placeholder:"Password",onChange:function(e){E(e.target.value)}}))),control:o.a.createElement(v.a,{onClick:function(e){e.preventDefault(),Z.a.post("/api/auth/signin",{username:u,password:h}).then((function(e){Y.authenticate((function(){r(!0)}))})).catch((function(e){console.log("catch",e),Y.authenticate((function(){r(!0)}))}))},variant:"primary",type:"submit"},"Submit"),setHasNotification:j,hasNotification:y,notificationContent:"Oops, something went wrong!"})}),ee=(a(251),function(e){var t=Object(c.useState)(""),a=Object(d.a)(t,2),n=a[0],r=a[1],i=Object(c.useState)(""),l=Object(d.a)(i,2),u=l[0],m=l[1],f=Object(c.useState)(""),p=Object(d.a)(f,2),h=p[0],E=p[1],g=Object(c.useState)(!1),b=Object(d.a)(g,2),y=b[0],j=b[1],O=Object(c.useState)(!1),w=Object(d.a)(O,2),C=w[0],S=w[1];return y?o.a.createElement(s.a,{to:"login"}):o.a.createElement(T,{title:"Sign Up",content:o.a.createElement(V.a,null,o.a.createElement(V.a.Control,{type:"text",placeholder:"Normal text",onChange:function(e){r(e.target.value)},value:n}),o.a.createElement(V.a.Group,{controlId:"formBasicEmail"},o.a.createElement(V.a.Label,null,"Email address"),o.a.createElement(V.a.Control,{type:"email",placeholder:"Enter email",onChange:function(e){m(e.target.value)},value:u}),o.a.createElement(V.a.Text,{className:"text-muted"},"We'll never share your email with anyone else.")),o.a.createElement(V.a.Group,{controlId:"formBasicPassword"},o.a.createElement(V.a.Label,null,"Password"),o.a.createElement(V.a.Control,{type:"password",placeholder:"Password",onChange:function(e){E(e.target.value)},value:h}))),control:o.a.createElement(v.a,{onClick:function(e){e.preventDefault(),Z.a.post("/api/auth/signup",{username:n,email:u,password:h,roles:["user"]}).then((function(e){j(!0)})).catch((function(e){console.log("catch",e),S(!0)}))},variant:"primary",type:"submit"},"Sign Up"),setHasNotification:S,hasNotification:C,notificationContent:"Oops, something went wrong!"})}),te=(a(252),function(){return o.a.createElement(o.a.Fragment,null,o.a.createElement("h1",null,"Welcome to EazyChat"),o.a.createElement(l.b,{to:"/signup"},"Sign up"),o.a.createElement(l.b,{to:"/login"},"Login"))}),ae=(a(253),function(e){var t=e.children;return o.a.createElement("section",{className:"chat__head"},t)}),ne=a(114),ce=function(e){var t=e.component,a=Object(ne.a)(e,["component"]);return o.a.createElement(s.b,Object.assign({},a,{render:function(e){return!0===Y.isAuthenticated?o.a.createElement(t,e):o.a.createElement(s.a,{to:{pathname:"/login",state:{from:e.location}}})}}))},oe=(a(254),Object(s.h)((function(e){var t=e.history;return Y.isAuthenticated&&o.a.createElement(v.a,{onClick:function(){Y.signout((function(){return t.push("/")}))}},"Sign out")}))),re=(a(255),function(){return o.a.createElement(l.a,null,o.a.createElement(u.a,null,o.a.createElement(m.a,null,o.a.createElement(ae,null,o.a.createElement(oe,null))),o.a.createElement(m.a,null,o.a.createElement(s.d,null,o.a.createElement(s.b,{path:"/",exact:!0,component:te}),o.a.createElement(s.b,{path:"/Signup",component:ee}),o.a.createElement(s.b,{path:"/login",component:$}),o.a.createElement(ce,{path:"/join",component:K}),o.a.createElement(ce,{path:"/chat",component:q}),o.a.createElement(s.a,{from:"*",to:"/"})))))});i.a.render(o.a.createElement(re,null),document.querySelector("#root"))}},[[115,1,2]]]);
//# sourceMappingURL=main.8558c2ca.chunk.js.map