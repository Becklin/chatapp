(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{115:function(e,t,a){e.exports=a(265)},154:function(e,t){},157:function(e,t,a){},158:function(e,t,a){},161:function(e,t,a){},209:function(e,t,a){},210:function(e,t,a){},215:function(e,t){},217:function(e,t){},231:function(e,t,a){},239:function(e,t,a){},241:function(e,t,a){},258:function(e,t,a){},259:function(e,t,a){},260:function(e,t,a){},261:function(e,t,a){},262:function(e,t,a){},263:function(e,t,a){},264:function(e,t,a){},265:function(e,t,a){"use strict";a.r(t);var n,c=a(0),o=a.n(c),r=a(11),l=a.n(r),i=a(8),s=a(6),u=a(61),m=a(7),f=a(103),d=a.n(f),p=a(104),h=a.n(p),g=a(268),E=a(269),b=a(270),v=(a(157),function(e){var t=e.onHandleClick,a=e.className,n=e.name,c=e.disabled,r=e.icon,l="icon-".concat(n);return o.a.createElement("span",{className:"chat__icon ".concat(a," ").concat(c?"disabled":"")},o.a.createElement("label",{className:"chat__label",htmlFor:l},r&&r),o.a.createElement("input",{className:"hidden-input",type:"file",name:l,id:l,accept:"image/*,video/*,audio/*",onChange:function(e){var a=Array.from(e.target.files),n=new FormData;n.append(0,a[0]),t(n.get(0))}}))}),y=(a(158),function(e){var t=e.message,a=e.setMessage,n=e.sendMessage,c=e.sendFile,r=e.uploadFile;return o.a.createElement("form",{className:"chat__form"},o.a.createElement("textarea",{className:"chat__message",placeholder:"write some message...",value:t,onChange:function(e){return a(e.target.value)},onKeyPress:function(e){return"Enter"===e.key?a(e.target.value):null}}),o.a.createElement("div",{className:"chat__controls"},o.a.createElement(v,{disabled:t,className:"chat__flex",type:"file",onHandleClick:c,icon:o.a.createElement(g.a,null),name:"files"}),o.a.createElement(v,{disabled:t,className:"chat__flex",type:"file",onHandleClick:r,icon:o.a.createElement(E.a,null),name:"upload"}),o.a.createElement(b.a,{className:"chat__flex",size:"32",onClick:t?function(e){console.log("dddd",e.target.value),n(e)}:null,color:t?"darkslategray":"#e3e3e3"})))}),j=a(271),O=a(272),k=(a(161),o.a.memo((function(e){var t=e.room,a=e.counts;return o.a.createElement("div",{className:"chat__infoBar"},o.a.createElement("div",{className:"chat__room"},o.a.createElement("h3",null,t)),o.a.createElement("div",{className:"chat__count"},a," ",o.a.createElement(j.a,{color:"#ffffff",size:24})),o.a.createElement("div",{className:"chat__back"},o.a.createElement(i.b,{to:"/"},o.a.createElement(O.a,{color:"white",size:24}))))}))),w=a(106),_=a.n(w),N=a(273),C=a(274),S=a(107),x=a.n(S),F=(a(209),function(e){var t=e.message,a=t.user,n=t.text,c=t.upload,r=t.type,l=t.address,i=e.name,s=e.avatarSrc,u=!1,m=i.trim().toLowerCase();m===a&&(u=!0);var f=u?"user":"friend",d="user"===f?m:a;return o.a.createElement("div",{className:"chat-message chat-message--".concat(f)},"friend"===f&&o.a.createElement("h4",null,s?o.a.createElement(N.a,{src:s,roundedCircle:!0}):o.a.createElement(C.a,{size:24}),o.a.createElement("span",null,d)),o.a.createElement("div",{className:"chat-message__body"},function(e,t){if(e)return o.a.createElement("div",{dangerouslySetInnerHTML:{__html:e}});if(t)switch(t){case"video/mp4":case"video/quicktime":return o.a.createElement("video",{controls:!0},o.a.createElement("source",{src:"data:image/png;base64, ".concat(c),type:"video/mp4"}),o.a.createElement("source",{src:"data:image/png;base64, ".concat(c),type:"video/ogg"}),"Your browser does not support the video tag.");case"image/*":default:return o.a.createElement("img",{className:"img-thumbnail img-fluid",src:"data:image/png;base64, ".concat(c)})}return o.a.createElement("p",{className:"chat-message__body--text"},x.a.emojify(n))}(l,r)))}),I=(a(210),o.a.memo((function(e){var t=e.messages,a=e.name;return o.a.createElement(_.a,{className:"chat__messages"},t.map((function(e,t){return o.a.createElement(F,{key:"name-".concat(t),message:e,name:a})})))}))),U=a(42),L=a(43),P=a(20),B=a.n(P),D=function(){function e(t,a,n){Object(U.a)(this,e),this.socket=a,this.file=t,this.name=t.name}return Object(L.a)(e,[{key:"send",value:function(){var e=B.a.createStream();B()(this.socket).emit("sendFile",e,{name:this.file.name,type:this.file.type,size:this.file.size}),B.a.createBlobReadStream(this.file).pipe(e)}},{key:"upload",value:function(){var e=B.a.createStream();B()(this.socket).emit("uploadFile",e,{name:this.file.name,type:this.file.type,size:this.file.size}),B.a.createBlobReadStream(this.file).pipe(e)}}],[{key:"process",value:function(t,a){var n=this,c={name:t.name,quality:.6};return z(t,c).then((function(e){var t=e.readerData,a=e.config,c=e.callback;return n.base64=t,A(t,a,c)})).then((function(e){var t=e.base64,a=e.config,c=e.callback;return n.minifiedBase64=t,R(t,a,c)})).then((function(t){return n.minifiedFile=t,new e(n.minifiedFile,a)}))}}]),e}(),z=function(e,t,a){return console.log("\u958b\u59cb",e),new Promise((function(n){var c=new FileReader;c.readAsDataURL(e),c.onload=function(){var e=this.result;n({readerData:e,config:t,callback:a})},c.onloadend=function(){console.log("\u52a0\u8f09\u5df2\u7d93\u7d50\u675f")}}))},A=function(e,t,a){return new Promise((function(n){var c=new Image;c.src=e,c.onload=function(){var e=400/(c.width/c.height),o=.7,r=document.createElement("canvas"),l=r.getContext("2d"),i=document.createAttribute("width");i.nodeValue=400;var s=document.createAttribute("height");s.nodeValue=e,r.setAttributeNode(i),r.setAttributeNode(s),l.drawImage(c,0,0,400,e),t.quality&&t.quality<=1&&t.quality>0&&(o=t.quality);var u=r.toDataURL("image/jpeg","image/webp",o);n({base64:u,config:t,callback:a})}}))},R=function(e,t){for(var a=e.split(","),n=a[0].match(/:(.*?);/)[1],c=atob(a[1]),o=c.length,r=new Uint8Array(o);o--;)r[o]=c.charCodeAt(o);return new File([r],t.name,{type:n})},q=D,H=function(){var e=Object(s.g)().search,t=Object(c.useState)(""),a=Object(m.a)(t,2),r=a[0],l=a[1],i=Object(c.useState)(""),f=Object(m.a)(i,2),p=f[0],g=f[1],E=Object(c.useState)(""),b=Object(m.a)(E,2),v=b[0],j=b[1],O=Object(c.useState)([]),w=Object(m.a)(O,2),_=w[0],N=w[1],C=Object(c.useState)(0),S=Object(m.a)(C,2),x=S[0],F=S[1],U="https://freshtalk.herokuapp.com";Object(c.useEffect)((function(){var t=d.a.parse(e),a=t.name,c=t.room;return n=h()(U,{path:"/socket.io",transports:["websocket"],secure:!0}),l(a),g(c),n.emit("join",{name:a,room:c},(function(e){e&&alert(e)})),function(){n.emit("disconnect"),n.off()}}),[U,e]),Object(c.useEffect)((function(){n.on("message",(function(e){N((function(t){return[].concat(Object(u.a)(t),[e])}))})),n.on("file",(function(e){var t=e.user,a=e.upload,n=e.type;a&&N((function(e){return[].concat(Object(u.a)(e),[{user:t,upload:a,type:n}])}))}))}),[]),Object(c.useEffect)((function(){n.on("roomData",(function(e){var t=e.users;F(t.length)}))}),[x]);return o.a.createElement(o.a.Fragment,null,o.a.createElement(k,{room:p,counts:x}),o.a.createElement(I,{messages:_,name:r}),o.a.createElement(y,{message:v,setMessage:j,sendMessage:function(e){e.preventDefault(),v&&n.emit("sendMessage",v,(function(){return j("")}))},sendFile:function(e){q.process(e,n).then((function(e){e.send()}))},uploadFile:function(e){q.process(e,n).then((function(e){e.upload()}))}}))},J=a(278),M=a(279),G=(a(231),function(e){var t=e.title,a=e.content,n=e.control,c=e.hasNotification,r=e.notificationContent,l=o.a.createElement(M.a,{node:document&&document.getElementById("portal")},o.a.createElement(J.a,{delay:3e3,autohide:!0},o.a.createElement(J.a.Header,null,o.a.createElement("strong",{className:"mr-auto"},"FAILURE")),o.a.createElement(J.a.Body,null,r)));return o.a.createElement("div",{className:"chat__box"},o.a.createElement("h1",null,t),a,o.a.createElement("div",null,n),c&&l)});G.defaultProps={setHasNotification:function(){},hasNotification:!1};var T=G,V=a(277),K=a(280),W=(a(239),function(){var e=Object(c.useState)(""),t=Object(m.a)(e,2),a=t[0],n=t[1],r=Object(c.useState)(""),l=Object(m.a)(r,2),s=l[0],u=l[1];return o.a.createElement(T,{title:"Join",content:o.a.createElement(V.a,null,o.a.createElement(V.a.Group,{controlId:"formBasicPassword"},o.a.createElement(V.a.Label,null,"Username"),o.a.createElement(V.a.Control,{type:"text",placeholder:"Username",onChange:function(e){return n(e.target.value)}}),o.a.createElement(V.a.Label,null,"Room"),o.a.createElement(V.a.Control,{type:"text",placeholder:"Room",onChange:function(e){return u(e.target.value)}}))),control:o.a.createElement(i.b,{onClick:function(e){return a&&s?null:e.preventDefault()},to:"/chat?name=".concat(a,"&room=").concat(s)},o.a.createElement(K.a,{block:!0,type:"submit"},"Join In"))})}),Y=(a(241),a(31)),Q=a.n(Y),X="https://freshtalk.herokuapp.com/api/auth/",Z=new(function(){function e(){Object(U.a)(this,e)}return Object(L.a)(e,[{key:"login",value:function(e,t){return Q.a.post(X+"signin",{username:e,password:t}).then((function(e){return e.data.accessToken&&localStorage.setItem("user",JSON.stringify(e.data)),e.data}))}},{key:"logout",value:function(){localStorage.removeItem("user")}},{key:"signup",value:function(e,t,a){return Q.a.post(X+"signup",{username:e,email:t,password:a})}},{key:"getCurrentUser",value:function(){return JSON.parse(localStorage.getItem("user"))}}]),e}()),$=(a(258),function(e){var t=Object(c.useState)(!1),a=Object(m.a)(t,2),n=a[0],r=a[1],l=Object(c.useState)(""),i=Object(m.a)(l,2),u=i[0],f=i[1],d=Object(c.useState)(""),p=Object(m.a)(d,2),h=p[0],g=p[1],E=Object(c.useState)(!1),b=Object(m.a)(E,2),v=b[0],y=b[1];if(!0===n)return o.a.createElement(s.a,{to:"join"});return o.a.createElement(o.a.Fragment,null,o.a.createElement(T,{title:"Login",content:o.a.createElement(V.a,null,o.a.createElement(V.a.Control,{type:"text",placeholder:"Username",onChange:function(e){f(e.target.value)}}),o.a.createElement(V.a.Group,{controlId:"formBasicPassword"},o.a.createElement(V.a.Label,null,"Password"),o.a.createElement(V.a.Control,{type:"password",placeholder:"Password",onChange:function(e){g(e.target.value)}}))),control:o.a.createElement(K.a,{onClick:function(e){e.preventDefault(),Z.login(u,h).then((function(e){console.log("\u8cc7\u6599",e),r(!0)})).catch((function(e){console.log("catch",e),y(!0)}))},variant:"primary",type:"submit"},"Submit"),hasNotification:v,notificationContent:"Oops, something went wrong!"}))}),ee=(a(259),function(e){var t=Object(c.useState)(""),a=Object(m.a)(t,2),n=a[0],r=a[1],l=Object(c.useState)(""),i=Object(m.a)(l,2),u=i[0],f=i[1],d=Object(c.useState)(""),p=Object(m.a)(d,2),h=p[0],g=p[1],E=Object(c.useState)(!1),b=Object(m.a)(E,2),v=b[0],y=b[1],j=Object(c.useState)(!1),O=Object(m.a)(j,2),k=O[0],w=O[1];return v?o.a.createElement(s.a,{to:"login"}):o.a.createElement(T,{title:"Sign Up",content:o.a.createElement(V.a,null,o.a.createElement(V.a.Control,{type:"text",placeholder:"Normal text",onChange:function(e){r(e.target.value)},value:n}),o.a.createElement(V.a.Group,{controlId:"formBasicEmail"},o.a.createElement(V.a.Label,null,"Email address"),o.a.createElement(V.a.Control,{type:"email",placeholder:"Enter email",onChange:function(e){f(e.target.value)},value:u}),o.a.createElement(V.a.Text,{className:"text-muted"},"We'll never share your email with anyone else.")),o.a.createElement(V.a.Group,{controlId:"formBasicPassword"},o.a.createElement(V.a.Label,null,"Password"),o.a.createElement(V.a.Control,{type:"password",placeholder:"Password",onChange:function(e){g(e.target.value)},value:h}))),control:o.a.createElement(K.a,{onClick:function(e){e.preventDefault(),Q.a.post("/api/auth/signup",{username:n,email:u,password:h,roles:["user"]}).then((function(e){y(!0)})).catch((function(e){console.log("catch",e),w(!0)}))},variant:"primary",type:"submit"},"Sign Up"),setHasNotification:w,hasNotification:k,notificationContent:"Oops, something went wrong!"})}),te=(a(260),function(){return o.a.createElement("div",{className:"chat-home"},o.a.createElement("h1",null,"Fresh Talk"),o.a.createElement("div",{className:"chat-home__controls"},o.a.createElement(i.b,{to:"/signup"},"Sign up"),Z.getCurrentUser()?o.a.createElement(i.b,{to:"/join"},"Join"):o.a.createElement(i.b,{to:"/login"},"Login")))}),ae=(a(261),function(e){var t=e.children;return o.a.createElement("section",{className:"chat__head"},t)}),ne=a(112),ce=function(e){var t=e.component,a=Object(ne.a)(e,["component"]);return o.a.createElement(s.b,Object.assign({},a,{render:function(e){return Z.getCurrentUser()?o.a.createElement(t,e):o.a.createElement(s.a,{to:{pathname:"/login",state:{from:e.location}}})}}))},oe=a(275),re=(a(262),Object(s.h)((function(e){var t=e.history;return Z.getCurrentUser()&&o.a.createElement(oe.a,{size:"30",color:"#fff",onClick:function(){Z.logout(),t.push("/")}},"Sign out")}))),le=(a(276),a(263),a(264),function(){return o.a.createElement(i.a,null,o.a.createElement(ae,null,o.a.createElement(re,null)),o.a.createElement(s.d,null,o.a.createElement(s.b,{path:"/",exact:!0,component:te}),o.a.createElement(s.b,{path:"/Signup",component:ee}),o.a.createElement(s.b,{path:"/login",component:$}),o.a.createElement(ce,{path:"/join",component:W}),o.a.createElement(ce,{path:"/chat",component:H}),o.a.createElement(s.a,{from:"*",to:"/"})),o.a.createElement("div",{id:"portal"}))});l.a.render(o.a.createElement(le,null),document.querySelector("#root"))}},[[115,1,2]]]);
//# sourceMappingURL=main.e5768f06.chunk.js.map